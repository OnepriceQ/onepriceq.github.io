<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理後台 | 卓越金融</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #222; color: #fff; padding: 20px; }
        .login-box { max-width: 300px; margin: 100px auto; text-align: center; }
        .admin-panel { max-width: 900px; margin: 0 auto; background: #333; padding: 20px; border-radius: 8px; }
        .card { background: #444; padding: 15px; margin-bottom: 10px; border-radius: 5px; border-left: 5px solid #f2a900; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; }
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 3px; }
        .btn-approve { background: #28a745; color: white; }
        .btn-reject { background: #dc3545; color: white; margin-left: 10px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="login-screen" class="login-box">
    <h2>系統管理登入</h2>
    <input type="password" id="admin-pass" placeholder="輸入管理密碼">
    <button onclick="checkLogin()" style="width:100%; background: #f2a900;">登入</button>
</div>

<div id="panel-screen" class="admin-panel hidden">
    <h2>案件審核中樞</h2>
    <div id="data-list">加載中...</div>
    <button onclick="location.reload()" style="margin-top:20px;">刷新頁面</button>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDEsdCk1mhabHwZTqt7wRuC4_FH",
      authDomain: "theone-zero.firebaseapp.com",
      projectId: "theone-zero",
      storageBucket: "theone-zero.firebasestorage.app",
      messagingSenderId: "1067669012841",
      appId: "1:1067669012841:web:1694da76f172c6"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function checkLogin() {
        if(document.getElementById('admin-pass').value === '123456') {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('panel-screen').classList.remove('hidden');
            loadData();
        } else { alert("密碼錯誤"); }
    }

    function loadData() {
        db.ref('loans').on('value', snapshot => {
            let html = "";
            snapshot.forEach(child => {
                const m = child.val();
                const k = child.key;
                html += `
                <div class="card">
                    <p><strong>客戶：${m.name}</strong> | 手機：${m.phone}</p>
                    <p><strong>Line ID：${m.line}</strong> | 金額：$${m.amount}</p>
                    <p>用途：${m.reason}</p>
                    <p>目前狀態：<span style="color:#f2a900">${m.status}</span></p>
                    <button class="btn-approve" onclick="update('${k}','已撥款')">核准撥款</button>
                    <button class="btn-reject" onclick="update('${k}','不符資格')">駁回案件</button>
                    <button onclick="del('${k}')" style="background:#666; color:#fff; margin-left:10px;">刪除資料</button>
                </div>`;
            });
            document.getElementById('data-list').innerHTML = html || "暫無案件。";
        });
    }

    function update(key, status) {
        db.ref('loans/' + key).update({ status: status, time: new Date().toLocaleString() });
    }
    
    function del(key) {
        if(confirm("確定永久刪除此客戶資料？")) db.ref('loans/' + key).remove();
    }
</script>
</body>
</html>


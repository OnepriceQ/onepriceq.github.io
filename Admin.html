<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€šé€šå€Ÿ | ç¸½æ§å¾Œå°</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --accent: #6366f1; --bg: #0b0c10; --card: #161720; --sidebar: #12121c; }
        body { font-family: sans-serif; background: var(--bg); color: #fff; margin: 0; display: flex; height: 100vh; }
        
        /* å´é‚Šæ¬„å°é½Šæˆªåœ– */
        .sidebar { width: 260px; background: var(--sidebar); border-right: 1px solid #222; padding: 20px; }
        .nav-item { padding: 15px; margin-bottom: 5px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; color: #a0a0a0; }
        .nav-item.active { background: #2d2d44; color: #fff; border-left: 4px solid var(--accent); }
        
        /* ä¸»å€åŸŸ */
        .main { flex: 1; padding: 30px; overflow-y: auto; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid #222; }
        .stat-num { font-size: 24px; font-weight: bold; color: var(--accent); }

        /* ç¯©é¸æŒ‰éˆ•å°é½Šæˆªåœ– */
        .filter-bar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 15px; background: #1c1d29; border: 1px solid #333; border-radius: 20px; color: #888; cursor: pointer; }
        .filter-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }

        .search-box { width: 100%; padding: 12px; background: #1c1d29; border: 1px solid #333; border-radius: 10px; color: #fff; margin-bottom: 20px; }
        
        table { width: 100%; border-collapse: collapse; background: var(--card); border-radius: 15px; overflow: hidden; }
        th { background: #1e1e2d; padding: 15px; text-align: left; font-size: 13px; color: #888; }
        td { padding: 15px; border-bottom: 1px solid #222; }
        .status-badge { padding: 4px 10px; border-radius: 6px; font-size: 12px; background: #333; }
        .btn-clear { background: #e74c3c; padding: 10px; border: none; border-radius: 5px; color: #fff; cursor: pointer; margin-top: 50px; width: 100%; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="color:var(--accent);">é€šé€šå€Ÿ</h2>
    <div class="nav-item active">ğŸ“Š å„€è¡¨æ¿</div>
    <div class="nav-item">ğŸ“‹ ç”³è«‹æ¡ˆä»¶</div>
    <div class="nav-item">ğŸ’¸ å‡ºæ¬¾å¸³æœ¬ç®¡ç†</div>
    <div class="nav-item">ğŸ¦ é‚„æ¬¾å¸³æœ¬ç®¡ç†</div>
    <button class="btn-clear" onclick="clearAll()">ğŸ§¨ ä¸€éµæ¸…ç©ºæ‰€æœ‰è³‡æ–™</button>
</div>

<div class="main">
    <h1>å„€è¡¨æ¿</h1>
    <div class="stats-grid">
        <div class="stat-card"><div class="stat-num" id="count-all">0</div><div>ç¸½ç”³è«‹æ•¸</div></div>
        <div class="stat-card"><div class="stat-num" id="count-pending" style="color:#fbbf24;">0</div><div>å¾…å¯©æ ¸</div></div>
        <div class="stat-card"><div class="stat-num" id="count-paid" style="color:#4ade80;">0</div><div>å·²æ’¥æ¬¾</div></div>
        <div class="stat-card"><div class="stat-num" id="count-fail" style="color:#f87171;">0</div><div>å·²æ‹’çµ•</div></div>
    </div>

    <input type="text" class="search-box" id="searchInput" oninput="renderTable()" placeholder="ğŸ” è¼¸å…¥å§“åã€æ‰‹æ©Ÿæˆ–èº«åˆ†è­‰å­—è™Ÿæœå°‹...">

    <div class="filter-bar">
        <button class="filter-btn active" onclick="filterStatus('å…¨éƒ¨')">å…¨éƒ¨</button>
        <button class="filter-btn" onclick="filterStatus('å¾…å¯©æ ¸')">â³ å¾…å¯©æ ¸</button>
        <button class="filter-btn" onclick="filterStatus('å·²æ’¥æ¬¾')">ğŸ’° å·²æ’¥æ¬¾</button>
    </div>

    <table>
        <thead>
            <tr><th>ç”³è«‹äºº</th><th>å€Ÿæ¬¾è³‡è¨Š</th><th>ç‹€æ…‹</th><th>æ™‚é–“</th><th>æ“ä½œ</th></tr>
        </thead>
        <tbody id="caseList"></tbody>
    </table>
</div>

<script>
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY", // <--- å‹™å¿…æ›´æ›
        databaseURL: "https://theone-zero-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let allUsers = [];
    let currentFilter = 'å…¨éƒ¨';

    db.ref('users').on('value', snap => {
        allUsers = [];
        const data = snap.val();
        for(let key in data) allUsers.push(data[key]);
        updateStats();
        renderTable();
    });

    function updateStats() {
        document.getElementById('count-all').innerText = allUsers.length;
        document.getElementById('count-pending').innerText = allUsers.filter(u => u.status === 'å¾…å¯©æ ¸').length;
        document.getElementById('count-paid').innerText = allUsers.filter(u => u.status === 'å·²æ’¥æ¬¾').length;
        document.getElementById('count-fail').innerText = allUsers.filter(u => u.status === 'å·²æ‹’çµ•').length;
    }

    function renderTable() {
        const search = document.getElementById('searchInput').value.toLowerCase();
        const list = document.getElementById('caseList');
        list.innerHTML = '';

        allUsers.forEach(u => {
            if (currentFilter !== 'å…¨éƒ¨' && u.status !== currentFilter) return;
            if (search && !JSON.stringify(u).toLowerCase().includes(search)) return;

            list.innerHTML += `
                <tr>
                    <td><b>${u.name}</b><br><small>${u.phone}</small></td>
                    <td>${u.idCard}</td>
                    <td><span class="status-badge">${u.status}</span></td>
                    <td>${u.submitTime || 'N/A'}</td>
                    <td>
                        <button onclick="updateStatus('${u.phone}', 'å·²æ’¥æ¬¾')" style="background:#4ade80; border:none; border-radius:4px; padding:5px 10px; cursor:pointer;">å‡†</button>
                        <button onclick="updateStatus('${u.phone}', 'å·²æ‹’çµ•')" style="background:#f87171; border:none; border-radius:4px; padding:5px 10px; cursor:pointer; color:#fff;">æ ¸</button>
                    </td>
                </tr>`;
        });
    }

    function updateStatus(phone, status) {
        db.ref('users/' + phone).update({ status: status });
    }

    function filterStatus(s) {
        currentFilter = s;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.innerText.includes(s)));
        renderTable();
    }

    function clearAll() {
        if(confirm("å…ƒè€ï¼Œç¢ºå®šè¦ã€å…¨æ¸…ç©ºã€æ‰€æœ‰æ•¸æ“šå—ï¼ŸåŒ…å«å¸³æœ¬èˆ‡ç”³è«‹ç´€éŒ„ã€‚")) {
            db.ref('/').remove();
            alert("å·²æ¸…ç©ºï¼Œç›®å‰ç³»çµ±ç‚ºç´”æ·¨ç‰ˆã€‚");
        }
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>é‡‘åˆèˆ… JoJoPAY | ç®¡ç†ç¸½æ§</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --accent: #6366f1; --bg: #0b0c10; --card: #161720; --sidebar: #0e0f16; }
        body { font-family: sans-serif; background: var(--bg); color: #fff; margin: 0; display: flex; height: 100vh; }
        
        .sidebar { width: 260px; background: var(--sidebar); border-right: 1px solid #222; padding: 25px; display: flex; flex-direction: column; }
        .nav-item { padding: 15px; border-radius: 12px; cursor: pointer; color: #71717a; display: flex; align-items: center; margin-bottom: 5px; }
        .nav-item.active { background: #1e1e2e; color: #fff; border-left: 4px solid var(--accent); }
        
        .main { flex: 1; padding: 40px; overflow-y: auto; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 25px; border-radius: 15px; border: 1px solid #222; }
        .stat-num { font-size: 32px; font-weight: bold; color: var(--accent); }

        .search-input { width: 100%; padding: 14px; background: #1a1b26; border: 1px solid #333; border-radius: 12px; color: #fff; margin-bottom: 20px; outline: none; }
        .filter-bar { display: flex; gap: 10px; margin-bottom: 25px; }
        .filter-btn { padding: 8px 18px; background: #1a1b26; border: 1px solid #333; border-radius: 20px; color: #888; cursor: pointer; font-size: 13px; }
        .filter-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }

        table { width: 100%; border-collapse: collapse; background: var(--card); border-radius: 15px; overflow: hidden; }
        th { background: #1e1e2d; padding: 18px; text-align: left; color: #52525b; font-size: 13px; }
        td { padding: 18px; border-bottom: 1px solid #222; font-size: 14px; }
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 12px; background: #27272a; color: #fbbf24; }

        .btn-clear { background: #ef4444; color: #fff; border: none; padding: 12px; border-radius: 8px; cursor: pointer; margin-top: auto; font-weight: bold; }
    </style>
</head>
<body>

<div class="sidebar">
    <h1 style="color:var(--accent); font-size: 24px; letter-spacing: 2px;">JoJoPAY</h1>
    <div class="nav-item active">ğŸ“Š æ•¸æ“šå„€è¡¨æ¿</div>
    <div class="nav-item">ğŸ“‘ ç”³è«‹æ¡ˆä»¶å¯©æ ¸</div>
    <div class="nav-item">ğŸ’° å‡ºæ¬¾å¸³æœ¬ç®¡ç†</div>
    <button class="btn-clear" onclick="clearAll()">ğŸ§¨ å…¨ç³»çµ±è³‡æ–™æ¸…ç©º</button>
</div>

<div class="main">
    <div class="stats-grid">
        <div class="stat-card"><div class="stat-num" id="count-all">0</div><small style="color:#52525b">ç¸½ç”³è«‹æ•¸</small></div>
        <div class="stat-card"><div class="stat-num" id="count-pending" style="color:#fbbf24">0</div><small style="color:#52525b">å¾…å¯©æ ¸</small></div>
        <div class="stat-card"><div class="stat-num" id="count-done" style="color:#4ade80">0</div><small style="color:#52525b">å·²æ’¥æ¬¾</small></div>
        <div class="stat-card"><div class="stat-num" id="count-reject" style="color:#f87171">0</div><small style="color:#52525b">å·²æ‹’çµ•</small></div>
    </div>

    <input type="text" class="search-input" id="searchBox" placeholder="ğŸ” æœå°‹å§“åã€é›»è©±æˆ–èº«åˆ†è­‰..." oninput="renderTable()">

    <div class="filter-bar">
        <button class="filter-btn active" onclick="setFilter('å…¨éƒ¨')">å…¨éƒ¨</button>
        <button class="filter-btn" onclick="setFilter('å¾…å¯©æ ¸')">å¾…å¯©æ ¸</button>
        <button class="filter-btn" onclick="setFilter('å·²æ’¥æ¬¾')">å·²æ’¥æ¬¾</button>
    </div>

    <table>
        <thead>
            <tr><th>ç”³è«‹äººè³‡è¨Š</th><th>èº«åˆ†è­‰å­—è™Ÿ</th><th>ç‹€æ…‹</th><th>ç”³è«‹æ—¥æœŸ</th><th>ç®¡ç†æ“ä½œ</th></tr>
        </thead>
        <tbody id="caseList"></tbody>
    </table>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDEsdCk1mhabHwZTqt7wRuC4_FH",
        databaseURL: "https://theone-zero-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let allData = [];
    let filterStatus = 'å…¨éƒ¨';

    db.ref('users').on('value', snap => {
        allData = [];
        const val = snap.val();
        for(let id in val) allData.push(val[id]);
        updateStats();
        renderTable();
    });

    function updateStats() {
        document.getElementById('count-all').innerText = allData.length;
        document.getElementById('count-pending').innerText = allData.filter(u => u.status === 'å¾…å¯©æ ¸').length;
        document.getElementById('count-done').innerText = allData.filter(u => u.status === 'å·²æ’¥æ¬¾').length;
        document.getElementById('count-reject').innerText = allData.filter(u => u.status === 'å·²æ‹’çµ•').length;
    }

    function renderTable() {
        const search = document.getElementById('searchBox').value.toLowerCase();
        const tbody = document.getElementById('caseList');
        tbody.innerHTML = '';

        allData.forEach(u => {
            if (filterStatus !== 'å…¨éƒ¨' && u.status !== filterStatus) return;
            if (search && !JSON.stringify(u).toLowerCase().includes(search)) return;

            tbody.innerHTML += `
                <tr>
                    <td><b>${u.name}</b><br><small style="color:#71717a">${u.phone}</small></td>
                    <td>${u.idCard}</td>
                    <td><span class="badge">${u.status}</span></td>
                    <td>${u.submitTime || 'N/A'}</td>
                    <td>
                        <button onclick="updateStatus('${u.phone}', 'å·²æ’¥æ¬¾')" style="background:#4ade80; border:none; border-radius:4px; padding:5px 10px; cursor:pointer;">å‡†</button>
                        <button onclick="updateStatus('${u.phone}', 'å·²æ‹’çµ•')" style="background:#f87171; border:none; border-radius:4px; padding:5px 10px; cursor:pointer; color:#fff;">é§</button>
                    </td>
                </tr>`;
        });
    }

    function updateStatus(phone, status) {
        db.ref('users/' + phone).update({ status: status });
    }

    function setFilter(s) {
        filterStatus = s;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.innerText === s));
        renderTable();
    }

    function clearAll() {
        if(confirm("å…ƒè€ï¼Œç¢ºå®šè¦ã€å¾¹åº•æ¸…ç©ºã€æ‰€æœ‰æ•¸æ“šå—ï¼Ÿæ­¤å‹•ä½œä¸å¯é€†ï¼")) {
            db.ref('/').remove().then(() => alert("è³‡æ–™åº«å·²å…¨æ•¸æ›´æ–°ç‚ºç´”æ·¨ç‹€æ…‹ï¼"));
        }
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘åˆèˆ… | ç¸½æ§ç®¡ç†ç³»çµ±</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --gold: #d4af37; --bg-dark: #050505; --card-bg: #121212; --border: #2a2a2a; --text-gray: #a0a0a0; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg-dark); color: #fff; margin: 0; display: flex; height: 100vh; }
        
        /* å´é‚Šå°è¦½æ¬„ */
        .sidebar { width: 260px; background: #000; border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 30px 20px; font-size: 1.6rem; font-weight: bold; color: var(--gold); border-bottom: 1px solid var(--border); text-align: center; letter-spacing: 2px; }
        .nav-menu { flex: 1; padding: 20px 0; }
        .nav-link { padding: 15px 25px; cursor: pointer; color: var(--text-gray); display: flex; align-items: center; transition: 0.3s; border-left: 4px solid transparent; }
        .nav-link:hover, .nav-link.active { background: #1a1a1a; color: var(--gold); border-left: 4px solid var(--gold); }
        .nav-icon { margin-right: 15px; font-size: 1.2rem; }

        /* ä¸»å…§å®¹å€ */
        .content { flex: 1; overflow-y: auto; padding: 40px; }
        .dashboard-header { margin-bottom: 30px; border-left: 5px solid var(--gold); padding-left: 15px; }
        
        /* æ•¸æ“šå¡ç‰‡ */
        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: var(--card-bg); padding: 25px; border-radius: 10px; border: 1px solid var(--border); text-align: center; }
        .stat-num { font-size: 2.2rem; font-weight: bold; color: var(--gold); display: block; }
        .stat-title { color: var(--text-gray); font-size: 0.9rem; margin-top: 5px; }

        /* è¡¨æ ¼å„ªåŒ– */
        .table-wrapper { background: var(--card-bg); border-radius: 12px; border: 1px solid var(--border); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #1a1a1a; color: var(--gold); padding: 18px; text-align: left; font-size: 0.85rem; border-bottom: 1px solid var(--border); }
        td { padding: 18px; border-bottom: 1px solid var(--border); font-size: 0.95rem; color: #ddd; }
        
        /* æ†‘è­‰ç¸®åœ– */
        .doc-img { width: 50px; height: 50px; border-radius: 5px; object-fit: cover; cursor: pointer; border: 1px solid #444; margin-right: 5px; }
        .doc-img:hover { border-color: var(--gold); transform: scale(1.1); transition: 0.2s; }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-action { padding: 6px 15px; border-radius: 4px; border: none; font-weight: bold; cursor: pointer; margin-right: 5px; }
        .btn-pass { background: #2ecc71; color: #000; }
        .btn-reject { background: #e74c3c; color: #fff; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<aside class="sidebar">
    <div class="sidebar-header">é‡‘åˆèˆ… <span style="font-size: 0.7rem; display: block; color: #666;">JOJOPAY ADMIN</span></div>
    <nav class="nav-menu">
        <div class="nav-link active" onclick="switchTab('dash')"><span class="nav-icon">ğŸ </span>å„€è¡¨æ¿é¦–é </div>
        <div class="nav-link" onclick="switchTab('cases')"><span class="nav-icon">ğŸ“‘</span>å¾…å¯©æ ¸æ¡ˆä»¶</div>
        <div class="nav-link" onclick="switchTab('bank')"><span class="nav-icon">ğŸ¦</span>æ’¥æ¬¾å¸³æœ¬</div>
        <div class="nav-link" style="margin-top: 50px; color: #ff4d4d;" onclick="window.location.href='index.html'"><span class="nav-icon">ğŸšª</span>ç³»çµ±ç™»å‡º</div>
    </nav>
</aside>

<main class="content">
    <div id="tab-dash">
        <div class="dashboard-header"><h1>ç¸½æ§æ•¸æ“šä¸­å¿ƒ</h1></div>
        <div class="stats-container">
            <div class="stat-card"><span class="stat-num" id="total-users">0</span><span class="stat-title">ç¸½è¨»å†Šç”¨æˆ¶</span></div>
            <div class="stat-card"><span class="stat-num" id="pending-users" style="color: #ffcc00;">0</span><span class="stat-title">å¾…è™•ç†å¯©æ ¸</span></div>
            <div class="stat-card"><span class="stat-num" id="approved-users" style="color: #2ecc71;">0</span><span class="stat-title">å·²æ ¸å‡†æ’¥æ¬¾</span></div>
        </div>
        
        <div class="table-wrapper">
            <div style="padding: 20px; background: #1a1a1a; font-weight: bold; color: var(--gold);">âš¡ æœ€è¿‘ç”³è«‹å‹•æ…‹</div>
            <table>
                <thead><tr><th>ç”³è«‹äºº</th><th>æ‰‹æ©Ÿè™Ÿç¢¼</th><th>ç‹€æ…‹</th><th>ç”³è«‹æ™‚é–“</th><th>å¿«é€Ÿæ“ä½œ</th></tr></thead>
                <tbody id="recent-list"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-cases" class="hidden">
        <div class="dashboard-header"><h1>å¾…å¯©æ ¸æ¡ˆä»¶ç®¡ç†</h1></div>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>ç”³è«‹äººè³‡è¨Š</th>
                        <th>å­¸æ ¡ / å·¥ä½œ</th>
                        <th>é™„ä»¶æ†‘è­‰ (é»æ“Šæ”¾å¤§)</th>
                        <th>ç›®å‰ç‹€æ…‹</th>
                        <th>å¯©æ ¸å‹•ä½œ</th>
                    </tr>
                </thead>
                <tbody id="full-case-list"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-bank" class="hidden">
        <div class="dashboard-header"><h1>æ’¥æ¬¾å¸³æœ¬ (å‡ºæ¬¾å°ˆç”¨)</h1></div>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>æˆ¶å</th>
                        <th>éŠ€è¡Œä»£ç¢¼</th>
                        <th>åˆ†è¡Œåç¨±</th>
                        <th>åŒ¯æ¬¾å¸³è™Ÿ</th>
                        <th>é—œè¯æ‰‹æ©Ÿ</th>
                    </tr>
                </thead>
                <tbody id="bank-list"></tbody>
            </table>
        </div>
    </div>
</main>

<script>
    // --- Firebase é…ç½® ---
    const firebaseConfig = {
      apiKey: "AIzaSyDEsdCk1mhabHwZTqt7wRuC4_FH", 
      authDomain: "theone-zero.firebaseapp.com",
      projectId: "theone-zero",
      databaseURL: "https://theone-zero-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function switchTab(tabId) {
        document.querySelectorAll('.content > div').forEach(d => d.classList.add('hidden'));
        document.getElementById('tab-' + tabId).classList.remove('hidden');
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    // å³æ™‚ç›£è½æ•¸æ“š
    db.ref('users').on('value', snap => {
        const users = snap.val();
        let counts = { total: 0, pending: 0, approved: 0 };
        let recentHtml = '', fullHtml = '', bankHtml = '';

        for(let phone in users) {
            const u = users[phone];
            if(!u.name) continue; // éæ¿¾æ‰ç©ºå¸³è™Ÿ

            counts.total++;
            if(u.kycStatus === 'å¯©æ ¸ä¸­') counts.pending++;
            if(u.kycStatus === 'å·²æ ¸å‡†') counts.approved++;

            // åˆ—è¡¨è³‡æ–™
            const row = `<tr>
                <td>${u.name}</td>
                <td>${u.phone}</td>
                <td style="color:${u.kycStatus==='å¯©æ ¸ä¸­'?'#ffcc00':'#2ecc71'}">${u.kycStatus}</td>
                <td>${u.submitTime || 'N/A'}</td>
                <td><button class="btn-action btn-pass" onclick="updateUser('${u.phone}', 'å·²æ ¸å‡†')">å‡†</button></td>
            </tr>`;
            recentHtml += row;

            // å®Œæ•´å¯©æ ¸é 
            fullHtml += `<tr>
                <td><b>${u.name}</b><br><small>${u.phone}</small><br>Line: ${u.line || 'ç„¡'}</td>
                <td>ğŸ« ${u.school || 'æœªå¡«'}<br>ğŸ’¼ ${u.job || 'æœªå¡«'}</td>
                <td>
                    ${u.idImg ? `<img src="${u.idImg}" class="doc-img" onclick="window.open(this.src)">` : ''}
                    ${u.jobImg ? `<img src="${u.jobImg}" class="doc-img" onclick="window.open(this.src)">` : ''}
                    ${u.schoolImg ? `<img src="${u.schoolImg}" class="doc-img" onclick="window.open(this.src)">` : ''}
                </td>
                <td><span style="color:#ffcc00">${u.kycStatus}</span></td>
                <td>
                    <button class="btn-action btn-pass" onclick="updateUser('${u.phone}', 'å·²æ ¸å‡†')">æ ¸å‡†æ’¥æ¬¾</button>
                    <button class="btn-action btn-reject" onclick="updateUser('${u.phone}', 'å·²æ‹’çµ•')">æ‹’çµ•</button>
                </td>
            </tr>`;

            // å¸³æœ¬é  (é€™è£¡å‡è¨­ä¹‹å¾Œæ‚¨æœƒåœ¨å‰å°æ”¶é€™äº›è³‡æ–™ï¼Œç›®å‰å…ˆç•™ç©ºä½)
            bankHtml += `<tr>
                <td>${u.name}</td>
                <td>${u.bankCode || '008'}</td>
                <td>${u.bankBranch || 'å°åŒ—åˆ†è¡Œ'}</td>
                <td style="letter-spacing:1px; color:var(--gold)">${u.bankAcc || '123-456-7890XXX'}</td>
                <td>${u.phone}</td>
            </tr>`;
        }

        document.getElementById('total-users').innerText = counts.total;
        document.getElementById('pending-users').innerText = counts.pending;
        document.getElementById('approved-users').innerText = counts.approved;
        document.getElementById('recent-list').innerHTML = recentHtml;
        document.getElementById('full-case-list').innerHTML = fullHtml;
        document.getElementById('bank-list').innerHTML = bankHtml;
    });

    function updateUser(phone, status) {
        if(confirm(`ç¢ºèªå°‡ç”¨æˆ¶ ${phone} è®Šæ›´ç‚º [${status}] å—ï¼Ÿ`)) {
            db.ref('users/' + phone).update({ kycStatus: status });
        }
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘åˆèˆ… | å°ˆæ¥­æ”¾æ¬¾å¹³å°</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #1a2a6c; --accent: #f2a900; --bg: #f4f7f6; --dark: #0f172a; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); color: var(--dark); margin: 0; padding-bottom: 50px; }
        header { background: var(--dark); color: white; padding: 20px; text-align: center; border-bottom: 4px solid var(--accent); }
        .nav-bar { background: #fff; padding: 10px; display: flex; justify-content: center; gap: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .nav-link { cursor: pointer; font-weight: bold; color: var(--primary); }
        .container { max-width: 600px; margin: 30px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h2 { border-left: 5px solid var(--primary); padding-left: 10px; color: var(--primary); }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer; transition: 0.3s; }
        button:hover { background: #2a3a7c; }
        .hidden { display: none !important; }
        .ticker-item { border-bottom: 1px solid #eee; padding: 10px 0; font-size: 0.9rem; }
    </style>
</head>
<body>

<header>
    <h1>å“è¶Šé‡‘è <span>EXCELLENCE PAY</span></h1>
    <p>å¿«é€Ÿå¯©æ ¸ãƒ»èª ä¿¡æ’¥æ¬¾ãƒ»å€‹è³‡ä¿å¯†</p>
</header>

<div class="nav-bar">
    <div class="nav-link" onclick="showPage('apply-page')">ç·šä¸Šç”³è«‹</div>
    <div class="nav-link" onclick="showPage('status-page')">é€²åº¦æŸ¥è©¢</div>
    <div class="nav-link" onclick="showPage('info-page')">æ’¥æ¬¾å¿«å ±</div>
</div>

<div id="apply-page" class="container">
    <h2>è²¸æ¬¾ç”³è«‹å–®</h2>
    <input type="text" id="app-name" placeholder="çœŸå¯¦å§“å">
    <input type="text" id="app-phone" placeholder="è¡Œå‹•é›»è©±">
    <input type="text" id="app-line" placeholder="Line ID (é‡è¦)">
    <input type="number" id="app-amount" placeholder="å¸Œæœ›å€Ÿæ¬¾é‡‘é¡">
    <textarea id="app-reason" placeholder="å€Ÿæ¬¾ç”¨é€”èªªæ˜..."></textarea>
    <button onclick="submitApplication()">é€å‡ºç”³è«‹å–®</button>
</div>

<div id="status-page" class="container hidden">
    <h2>é€²åº¦æŸ¥è©¢</h2>
    <input type="text" id="query-phone" placeholder="è¼¸å…¥ç”³è«‹æ™‚çš„æ‰‹æ©Ÿè™Ÿç¢¼">
    <button onclick="queryStatus()">ç«‹å³æŸ¥è©¢</button>
    <div id="query-result" style="margin-top:20px; text-align:center;"></div>
</div>

<div id="info-page" class="container hidden">
    <h2>æœ€æ–°æ’¥æ¬¾å‹•æ…‹</h2>
    <div id="ticker-list">è®€å–ä¸­...</div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDEsdCk1mhabHwZTqt7wRuC4_FH",
      authDomain: "theone-zero.firebaseapp.com",
      projectId: "theone-zero",
      storageBucket: "theone-zero.firebasestorage.app",
      messagingSenderId: "1067669012841",
      appId: "1:1067669012841:web:1694da76f172c6",
      databaseURL: "https://theone-zero-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function showPage(id) {
        document.querySelectorAll('.container').forEach(p => p.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(id === 'info-page') loadTicker();
    }

    function submitApplication() {
        const data = {
            name: document.getElementById('app-name').value,
            phone: document.getElementById('app-phone').value,
            line: document.getElementById('app-line').value,
            amount: document.getElementById('app-amount').value,
            reason: document.getElementById('app-reason').value,
            status: 'å¯©æ ¸ä¸­',
            time: new Date().toLocaleString()
        };
        if(!data.name || !data.phone || !data.line) return alert("è«‹å¡«å¯«å¿…å¡«æ¬„ä½");
        
        db.ref('loans').push(data).then(() => {
            alert("æäº¤æˆåŠŸï¼å°ˆå“¡å°‡ç›¡å¿«èˆ‡æ‚¨è¯ç¹«ã€‚");
            showPage('status-page');
        }).catch(err => {
            alert("éŒ¯èª¤ï¼šè³‡æ–™åº«é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥è¦å‰‡ã€‚");
            console.error(err);
        });
    }

    function queryStatus() {
        const phone = document.getElementById('query-phone').value;
        db.ref('loans').orderByChild('phone').equalTo(phone).once('value', snapshot => {
            if(!snapshot.exists()) return document.getElementById('query-result').innerText = "æŸ¥ç„¡è³‡æ–™ã€‚";
            const item = Object.values(snapshot.val())[0];
            document.getElementById('query-result').innerHTML = `<h3>ç‹€æ…‹ï¼š${item.status}</h3><p>æœ€å¾Œæ›´æ–°ï¼š${item.time}</p>`;
        });
    }

    function loadTicker() {
        db.ref('loans').limitToLast(10).once('value', snapshot => {
            let html = "";
            snapshot.forEach(child => {
                const m = child.val();
                if(m.status === 'å·²æ’¥æ¬¾') html += `<div class="ticker-item">ğŸ‰ æ­å–œ ${m.name[0]}O${m.name.slice(-1)} æˆåŠŸæ’¥æ¬¾ $${m.amount}</div>`;
            });
            document.getElementById('ticker-list').innerHTML = html || "ç›®å‰å°šç„¡æ’¥æ¬¾è³‡æ–™ã€‚";
        });
    }
</script>
</body>
</html>

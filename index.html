<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘åˆèˆ… JOJOPAY | å°ˆæ¥­è²¸æ¬¾å¹³å°</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #d4af37; --secondary: #1a1a1a; --text: #ffffff; --error: #ff4d4d; }
        body { font-family: 'PingFang TC', sans-serif; background: #000; color: var(--text); margin: 0; padding-bottom: 50px; }
        header { background: var(--secondary); padding: 25px; text-align: center; border-bottom: 3px solid var(--primary); }
        .logo { font-size: 2.2rem; font-weight: bold; color: var(--primary); letter-spacing: 3px; }
        .container { max-width: 500px; margin: 20px auto; background: #111; padding: 25px; border-radius: 12px; border: 1px solid #333; }
        h2 { border-left: 4px solid var(--primary); padding-left: 10px; font-size: 1.3rem; }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid #444; color: #fff; border-radius: 6px; box-sizing: border-box; }
        
        /* å‚™è¨»æ¨£å¼ */
        .line-notice { background: rgba(255, 77, 77, 0.1); border: 1px solid var(--error); color: var(--error); padding: 10px; border-radius: 5px; font-size: 0.85rem; margin: 5px 0 15px; line-height: 1.5; }
        .file-label { display: block; margin: 20px 0 5px; color: var(--primary); font-size: 1rem; font-weight: bold; }
        .file-hint { font-size: 0.8rem; color: #aaa; margin-bottom: 10px; line-height: 1.4; }
        
        button { width: 100%; padding: 15px; background: var(--primary); color: #000; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 15px; font-size: 1rem; }
        .nav-bar { display: flex; justify-content: space-around; background: #222; padding: 15px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #333; }
        .nav-item { cursor: pointer; color: var(--primary); font-weight: bold; }
        .hidden { display: none; }
        .status-box { padding: 20px; background: #222; border-radius: 8px; margin-top: 10px; border: 1px solid var(--primary); text-align: center; }
        hr { border: 0.5px solid #333; margin: 25px 0; }
    </style>
</head>
<body>

<header>
    <div class="logo">é‡‘åˆèˆ… JOJOPAY</div>
    <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">JOJO PAY, EASY WAY.</div>
</header>

<div id="nav" class="nav-bar hidden">
    <div class="nav-item" onclick="showPage('member-center')">æœƒå“¡ä¸­å¿ƒ</div>
    <div class="nav-item" onclick="showPage('loan-page')">ç”³è«‹è²¸æ¬¾</div>
    <div class="nav-item" onclick="showPage('repay-page')">ç¹³æ¬¾å›å ±</div>
    <div class="nav-item" onclick="logout()">ç™»å‡º</div>
</div>

<div id="auth-page" class="container">
    <h2>æœƒå“¡ç™»å…¥ / è¨»å†Š</h2>
    <input type="text" id="auth-phone" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼">
    <input type="password" id="auth-pw" placeholder="è¨­å®šå¯†ç¢¼">
    <button onclick="handleAuth()">é€²å…¥é‡‘åˆèˆ…ç³»çµ±</button>
</div>

<div id="member-center" class="container hidden">
    <h2>å¯¦åèªè­‰ (KYC)</h2>
    <div id="kyc-form">
        <input type="text" id="kyc-name" placeholder="çœŸå¯¦å§“å">
        <input type="text" id="kyc-id" placeholder="èº«åˆ†è­‰å­—è™Ÿ">
        
        <input type="text" id="kyc-line" placeholder="Line ID (å¿…å¡«)">
        <div class="line-notice">
            âš ï¸ <b>è«‹å‹™å¿…å®Œæˆä»¥ä¸‹è¨­å®šï¼Œå¦å‰‡å°ˆå“¡ç„¡æ³•è¯ç¹«ï¼š</b><br>
            1. é»æ“Š Line è¨­å®š > éš±ç§è¨­å®š > <b>ã€Œå…è¨±åˆ©ç”¨ ID åŠ å…¥å¥½å‹ã€æ‰“å‹¾</b>ã€‚<br>
            2. ç¢ºä¿ <b>ã€Œé˜»æ“‹é™Œç”Ÿè¨Šæ¯ã€åŠŸèƒ½é—œé–‰</b>ã€‚
        </div>
        
        <hr>
        <div class="file-label">ğŸ“¸ æœ¬äººèº«åˆ†è­‰</div>
        <div class="file-hint">è«‹ä¸Šå‚³æœ¬äººèº«åˆ†è­‰ æ­£é¢èˆ‡åé¢ã€‚</div>
        <input type="file" id="img-id-front" accept="image/*">
        <input type="file" id="img-id-back" accept="image/*">

        <div class="file-label">ğŸ“¸ çˆ¶æ¯/æ‰¶é¤Šè€…è­‰ä»¶</div>
        <div class="file-hint">ä¸Šå‚³çˆ¶æ¯èº«åˆ†è­‰æ­£åé¢ã€‚è‹¥çˆ¶æ¯é›™äº¡ï¼Œè«‹é™„ä¸Šæˆ¶å£åç°¿åŠæ‰¶é¤Šè€…èº«åˆ†è­‰ã€‚</div>
        <input type="file" id="img-parent-front" accept="image/*">
        <input type="file" id="img-parent-back" accept="image/*">

        <hr>
        <div class="file-label">ğŸ¤³ æ‰‹æŒè­‰ä»¶è‡ªæ‹ç…§</div>
        <div class="file-hint">
            1. ä¸€æ‰‹æŒèº«åˆ†è­‰ï¼ˆæ‰‹æŒ‡åˆ¥æ“‹ä½è­‰ä»¶å­—é«”ï¼‰ã€‚<br>
            2. å¦ä¸€æ‰‹æŒæ‰‹å¯«å­—æ¢ï¼š<br>
            <b style="color:#fff">ã€Œæœ¬äºº (å§“å) æ–¼ 2026/02/28 ç”³è«‹ JOJO æœƒå“¡ã€</b>
        </div>
        <input type="file" id="img-selfie" accept="image/*">

        <button onclick="submitKYC()">æäº¤ä¸¦é–‹å§‹å¯©æ ¸</button>
    </div>
    
    <div id="kyc-status" class="hidden">
        <div class="status-box">
            <h3 style="color:var(--primary)">è³‡æ–™å¯©æ ¸ä¸­</h3>
            <p>æ‚¨çš„å¯¦åèªè­‰è³‡æ–™å·²æäº¤æˆåŠŸã€‚</p>
            <p style="font-size: 0.9rem; color:#888;">å°ˆå“¡å°‡é€é Line èˆ‡æ‚¨è¯ç¹«ï¼Œè«‹ç¢ºä¿ ID æœå°‹å·²é–‹å•Ÿã€‚</p>
        </div>
    </div>
</div>

<div id="loan-page" class="container hidden">
    <h2>ç”³è«‹è²¸æ¬¾</h2>
    <div id="loan-locked">
        <p style="color: var(--error); text-align:center;">âš ï¸ éœ€å®Œæˆé«˜ç´šå¯¦åèªè­‰ä¸¦å¯©æ ¸é€šéå¾Œæ–¹å¯ç”³è«‹ã€‚</p>
    </div>
    <div id="loan-form" class="hidden">
        <input type="number" id="loan-amount" placeholder="å¸Œæœ›å€Ÿæ¬¾é‡‘é¡">
        <textarea id="loan-reason" placeholder="å€Ÿæ¬¾ç”¨é€”èªªæ˜..."></textarea>
        <button onclick="submitLoan()">ç¢ºèªæäº¤è²¸æ¬¾ç”³è«‹</button>
    </div>
</div>

<div id="repay-page" class="container hidden">
    <h2>ç¹³æ¬¾å›å ±</h2>
    <input type="number" id="repay-amount" placeholder="æœ¬æ¬¡ç¹³æ¬¾é‡‘é¡">
    <input type="text" id="repay-note" placeholder="å‚™è¨» (å¦‚ï¼šåŒ¯æ¬¾å¾Œäº”ç¢¼)">
    <button onclick="submitRepay()">æäº¤ç¹³æ¬¾è­‰æ˜</button>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDEsdCk1mhabHwZTqt7wRuC4_FH",
      authDomain: "theone-zero.firebaseapp.com",
      projectId: "theone-zero",
      storageBucket: "theone-zero.firebasestorage.app",
      messagingSenderId: "1067669012841",
      appId: "1:1067669012841:web:1694da76f172c6",
      databaseURL: "https://theone-zero-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentUser = null;

    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });

    async function submitKYC() {
        const name = document.getElementById('kyc-name').value;
        const idNum = document.getElementById('kyc-id').value;
        const line = document.getElementById('kyc-line').value;
        
        const f1 = document.getElementById('img-id-front').files[0];
        const f5 = document.getElementById('img-selfie').files[0];

        if(!name || !idNum || !line || !f1 || !f5) return alert("è«‹å®Œæ•´å¡«å¯«è³‡æ–™ï¼Œä¸¦ç¢ºä¿ä¸Šå‚³äº†èº«åˆ†è­‰èˆ‡è‡ªæ‹ç…§ã€‚");

        alert("æ­£åœ¨ä¸Šå‚³åŠ å¯†è³‡æ–™ï¼Œè«‹å‹¿é—œé–‰ç¶²é ...");

        const kycData = {
            name: name,
            idCardNumber: idNum,
            line: line,
            kycStatus: 'å¯©æ ¸ä¸­',
            imgIdFront: await toBase64(f1),
            imgSelfie: await toBase64(f5),
            submitTime: new Date().toLocaleString()
        };
        
        // é¸å¡«æ¬„ä½è™•ç†
        const f2 = document.getElementById('img-id-back').files[0];
        if(f2) kycData.imgIdBack = await toBase64(f2);
        const f3 = document.getElementById('img-parent-front').files[0];
        if(f3) kycData.imgParentFront = await toBase64(f3);
        const f4 = document.getElementById('img-parent-back').files[0];
        if(f4) kycData.imgParentBack = await toBase64(f4);

        db.ref('users/' + currentUser).update(kycData).then(() => {
            alert("æäº¤æˆåŠŸï¼");
            showPage('member-center');
        });
    }

    function showPage(id) {
        document.querySelectorAll('.container').forEach(p => p.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(currentUser) checkUserStatus();
    }

    function handleAuth() {
        const phone = document.getElementById('auth-phone').value;
        const pw = document.getElementById('auth-pw').value;
        if(!phone || !pw) return alert("è«‹è¼¸å…¥æ‰‹æ©Ÿèˆ‡å¯†ç¢¼");
        db.ref('users/' + phone).once('value', snap => {
            if(snap.exists()) {
                if(snap.val().pw === pw) { login(phone); } else { alert("å¯†ç¢¼éŒ¯èª¤"); }
            } else {
                db.ref('users/' + phone).set({ pw: pw, kycStatus: 'æœªèªè­‰', phone: phone }).then(() => login(phone));
            }
        });
    }

    function login(phone) {
        currentUser = phone;
        document.getElementById('auth-page').classList.add('hidden');
        document.getElementById('nav').classList.remove('hidden');
        showPage('member-center');
    }

    function checkUserStatus() {
        db.ref('users/' + currentUser).on('value', snap => {
            const user = snap.val();
            if(user.kycStatus === 'å·²èªè­‰') {
                document.getElementById('kyc-form').classList.add('hidden');
                document.getElementById('kyc-status').classList.remove('hidden');
                document.getElementById('kyc-status').innerHTML = '<div class="status-box">âœ… æ‚¨å·²é€šéå¯¦åèªè­‰ï¼Œå¯ç”³è«‹è²¸æ¬¾ã€‚</div>';
                document.getElementById('loan-locked').classList.add('hidden');
                document.getElementById('loan-form').classList.remove('hidden');
            } else if (user.kycStatus === 'å¯©æ ¸ä¸­') {
                document.getElementById('kyc-form').classList.add('hidden');
                document.getElementById('kyc-status').classList.remove('hidden');
            }
        });
    }

    function submitLoan() {
        const amount = document.getElementById('loan-amount').value;
        const reason = document.getElementById('loan-reason').value;
        if(!amount) return alert("è«‹è¼¸å…¥å€Ÿæ¬¾é‡‘é¡");
        db.ref('loan_apps').push({
            user: currentUser, amount: amount, reason: reason, status: 'å¾…å¯©æ ¸', time: new Date().toLocaleString()
        }).then(() => alert("è²¸æ¬¾ç”³è«‹æˆåŠŸï¼Œè«‹ç­‰å€™é€šçŸ¥ã€‚"));
    }

    function submitRepay() {
        const amount = document.getElementById('repay-amount').value;
        if(!amount) return alert("è«‹è¼¸å…¥é‡‘é¡");
        db.ref('repayments').push({
            user: currentUser, amount: amount, note: document.getElementById('repay-note').value, time: new Date().toLocaleString()
        }).then(() => alert("ç¹³æ¬¾å›å ±æˆåŠŸã€‚"));
    }

    function logout() { location.reload(); }
</script>
</body>
</html>

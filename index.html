<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘åˆèˆ… JOJOPAY | å°ˆæ¥­è²¸æ¬¾å¹³å°</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #d4af37; --secondary: #1a1a1a; --text: #ffffff; --success: #2ecc71; }
        body { font-family: 'PingFang TC', sans-serif; background: #000; color: var(--text); margin: 0; padding-bottom: 60px; }
        header { background: var(--secondary); padding: 20px; text-align: center; border-bottom: 2px solid var(--primary); }
        .container { max-width: 450px; margin: 15px auto; background: #111; padding: 20px; border-radius: 15px; border: 1px solid #333; }
        
        /* é€²åº¦æ¢è¨­è¨ˆ */
        .steps-bar { display: flex; justify-content: space-between; margin-bottom: 30px; position: relative; }
        .step { width: 35px; height: 35px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; z-index: 2; position: relative; font-size: 0.9rem; }
        .step.active { background: var(--primary); color: #000; }
        .step.done { background: var(--success); color: #fff; }
        .steps-bar::after { content: ''; position: absolute; top: 17px; left: 0; right: 0; height: 2px; background: #333; z-index: 1; }

        input, button, select { width: 100%; padding: 15px; margin: 10px 0; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        input { background: #222; border: 1px solid #444; color: #fff; }
        button { background: var(--primary); color: #000; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-gray { background: #444; color: #fff; }
        .hidden { display: none; }
        .file-box { border: 2px dashed #444; padding: 15px; text-align: center; border-radius: 8px; margin: 10px 0; background: #1a1a1a; }
        .label-gold { color: var(--primary); font-weight: bold; font-size: 0.9rem; display: block; margin-top: 10px; }
    </style>
</head>
<body>

<header><div style="font-size: 1.5rem; color: var(--primary); font-weight: bold;">é‡‘åˆèˆ… JOJOPAY</div></header>

<div id="auth-section">
    <div id="login-page" class="container">
        <h2>æœƒå“¡ç™»å…¥</h2>
        <input type="text" id="login-phone" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼">
        <input type="password" id="login-pw" placeholder="å¯†ç¢¼">
        <button onclick="handleLogin()">ç™»å…¥ç³»çµ±</button>
        <button class="btn-gray" onclick="showAuth('register')">è¨»å†Šæ–°å¸³è™Ÿ</button>
    </div>

    <div id="register-page" class="container hidden">
        <h2>æ–°æœƒå“¡è¨»å†Š</h2>
        <input type="text" id="reg-phone" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼">
        <input type="password" id="reg-pw" placeholder="ç™»å…¥å¯†ç¢¼">
        <input type="text" id="reg-id" placeholder="èº«åˆ†è­‰å­—è™Ÿ">
        <span class="label-gold">å‡ºç”Ÿå¹´æœˆæ—¥</span>
        <input type="date" id="reg-birthday">
        <button onclick="handleRegister()">å®Œæˆè¨»å†Š</button>
        <button class="btn-gray" onclick="showAuth('login')">è¿”å›ç™»å…¥</button>
    </div>
</div>

<div id="kyc-section" class="hidden">
    <div class="container">
        <div class="steps-bar">
            <div id="s1" class="step active">1</div>
            <div id="s2" class="step">2</div>
            <div id="s3" class="step">3</div>
            <div id="s4" class="step">4</div>
        </div>

        <div id="step-1">
            <h3>åŸºæœ¬è³‡æ–™</h3>
            <input type="text" id="kyc-name" placeholder="çœŸå¯¦å§“å">
            <input type="text" id="kyc-line" placeholder="Line ID">
            <button onclick="nextStep(2)">ä¸‹ä¸€æ­¥ï¼šå·¥ä½œèˆ‡å­¸ç±</button>
        </div>

        <div id="step-2" class="hidden">
            <h3>ç¾æ³è³‡è¨Š</h3>
            <span class="label-gold">ğŸ’¼ å·¥ä½œå–®ä½</span>
            <input type="text" id="kyc-job" placeholder="ä¾‹å¦‚ï¼šå°ç©é›» / å·¥ç¨‹å¸«">
            <span class="label-gold">ğŸ“ å°±è®€å­¸æ ¡</span>
            <input type="text" id="kyc-school" placeholder="ä¾‹å¦‚ï¼šå°ç£å¤§å­¸ / è³‡ç®¡ç³»">
            <div style="display: flex; gap: 10px;">
                <button class="btn-gray" onclick="nextStep(1)">ä¸Šä¸€æ­¥</button>
                <button onclick="nextStep(3)">ä¸‹ä¸€æ­¥ï¼šé™„ä»¶ä¸Šå‚³</button>
            </div>
        </div>

        <div id="step-3" class="hidden">
            <h3>é™„ä»¶è­‰æ˜ä¸Šå‚³</h3>
            <div class="file-box">
                <span class="label-gold">èº«åˆ†è­‰ (æ­£é¢)</span>
                <input type="file" id="img-id" accept="image/*">
            </div>
            <div class="file-box">
                <span class="label-gold">å·¥ä½œè­‰æ˜ (å·¥ä½œè­‰/åç‰‡)</span>
                <input type="file" id="img-job" accept="image/*">
            </div>
            <div class="file-box">
                <span class="label-gold">å­¸ç”Ÿè­‰è­‰æ˜</span>
                <input type="file" id="img-school" accept="image/*">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn-gray" onclick="nextStep(2)">ä¸Šä¸€æ­¥</button>
                <button onclick="submitAllKYC()">é€å‡ºç”³è«‹</button>
            </div>
        </div>

        <div id="step-4" class="hidden" style="text-align: center;">
            <div style="font-size: 4rem; color: var(--success);">âœ“</div>
            <h2>ç”³è«‹å·²é€å‡º</h2>
            <p>æ„Ÿè¬æ‚¨çš„ç”³è«‹ï¼Œå°ˆå“¡å°‡ç›¡é€Ÿå¯©æ ¸ã€‚</p>
            <button onclick="location.reload()">å›åˆ°é¦–é </button>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDEsdCk1mhabHwZTqt7wRuC4_FH",
      authDomain: "theone-zero.firebaseapp.com",
      projectId: "theone-zero",
      databaseURL: "https://theone-zero-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentUser = null;

    function showAuth(type) {
        document.getElementById('login-page').classList.toggle('hidden', type === 'register');
        document.getElementById('register-page').classList.toggle('hidden', type === 'login');
    }

    function handleRegister() {
        const phone = document.getElementById('reg-phone').value;
        const pw = document.getElementById('reg-pw').value;
        if(!phone || !pw) return alert("è«‹å¡«å¯«æ‰‹æ©Ÿèˆ‡å¯†ç¢¼");
        db.ref('users/' + phone).set({
            phone: phone, pw: pw, idNum: document.getElementById('reg-id').value,
            birthday: document.getElementById('reg-birthday').value, kycStatus: 'æœªèªè­‰'
        }).then(() => { alert("è¨»å†ŠæˆåŠŸï¼è«‹ç™»å…¥"); showAuth('login'); });
    }

    function handleLogin() {
        const phone = document.getElementById('login-phone').value;
        const pw = document.getElementById('login-pw').value;
        db.ref('users/' + phone).once('value', snap => {
            const u = snap.val();
            if(u && u.pw === pw) {
                currentUser = phone;
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('kyc-section').classList.remove('hidden');
                if(u.kycStatus === 'å¯©æ ¸ä¸­') nextStep(4);
            } else { alert("ç™»å…¥å¤±æ•—"); }
        });
    }

    function nextStep(stepNum) {
        for(let i=1; i<=4; i++) {
            document.getElementById('step-'+i).classList.add('hidden');
            document.getElementById('s'+i).classList.remove('active', 'done');
            if(i < stepNum) document.getElementById('s'+i).classList.add('done');
        }
        document.getElementById('step-'+stepNum).classList.remove('hidden');
        document.getElementById('s'+stepNum).classList.add('active');
    }

    const toBase64 = file => new Promise((resolve) => {
        if(!file) resolve("");
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
    });

    async function submitAllKYC() {
        alert("è³‡æ–™ä¸Šå‚³ä¸­ï¼Œè«‹å‹¿é—œé–‰è¦–çª—...");
        const data = {
            name: document.getElementById('kyc-name').value,
            line: document.getElementById('kyc-line').value,
            job: document.getElementById('kyc-job').value,
            school: document.getElementById('kyc-school').value,
            idImg: await toBase64(document.getElementById('img-id').files[0]),
            jobImg: await toBase64(document.getElementById('img-job').files[0]),
            schoolImg: await toBase64(document.getElementById('img-school').files[0]),
            kycStatus: 'å¯©æ ¸ä¸­'
        };
        db.ref('users/' + currentUser).update(data).then(() => {
            nextStep(4);
        });
    }
</script>
</body>
</html>

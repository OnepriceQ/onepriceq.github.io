<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘åˆèˆ… JOJOPAY | å°ˆæ¥­è²¸æ¬¾å¹³å°</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #d4af37; --secondary: #1a1a1a; --text: #ffffff; --error: #ff4d4d; }
        body { font-family: 'PingFang TC', sans-serif; background: #000; color: var(--text); margin: 0; padding-bottom: 50px; }
        header { background: var(--secondary); padding: 25px; text-align: center; border-bottom: 3px solid var(--primary); }
        .logo { font-size: 2.2rem; font-weight: bold; color: var(--primary); letter-spacing: 3px; }
        .container { max-width: 500px; margin: 20px auto; background: #111; padding: 25px; border-radius: 12px; border: 1px solid #333; }
        h2 { border-left: 4px solid var(--primary); padding-left: 10px; font-size: 1.3rem; margin-bottom: 20px; }
        input, button { width: 100%; padding: 15px; margin: 10px 0; border-radius: 6px; box-sizing: border-box; }
        input { background: #222; border: 1px solid #444; color: #fff; }
        button { background: var(--primary); color: #000; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #f1c40f; }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); margin-top: 5px; }
        .nav-bar { display: flex; justify-content: space-around; background: #222; padding: 15px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #333; }
        .nav-item { cursor: pointer; color: var(--primary); font-weight: bold; }
        .hidden { display: none !important; }
        .line-notice { border: 1px solid var(--error); color: var(--error); padding: 10px; font-size: 0.85rem; margin-bottom: 15px; border-radius: 5px; }
        .file-label { display: block; margin: 20px 0 5px; color: var(--primary); font-weight: bold; }
        .file-hint { font-size: 0.8rem; color: #aaa; margin-bottom: 10px; }
    </style>
</head>
<body>

<header>
    <div class="logo">é‡‘åˆèˆ… JOJOPAY</div>
</header>

<div id="nav" class="nav-bar hidden">
    <div class="nav-item" onclick="showPage('member-center')">æœƒå“¡ä¸­å¿ƒ</div>
    <div class="nav-item" onclick="showPage('loan-page')">ç”³è«‹è²¸æ¬¾</div>
    <div class="nav-item" onclick="showPage('repay-page')">ç¹³æ¬¾å›å ±</div>
    <div class="nav-item" onclick="logout()">ç™»å‡º</div>
</div>

<div id="login-page" class="container">
    <h2>æœƒå“¡ç™»å…¥</h2>
    <input type="text" id="login-phone" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼">
    <input type="password" id="login-pw" placeholder="å¯†ç¢¼">
    <button onclick="handleLogin()">ç™»å…¥</button>
    <button class="btn-outline" onclick="toggleAuth('register')">æ²’æœ‰å¸³è™Ÿï¼Ÿç«‹å³è¨»å†Š</button>
</div>

<div id="register-page" class="container hidden">
    <h2>æ–°æœƒå“¡è¨»å†Š</h2>
    <div id="reg-step-1">
        <input type="text" id="reg-phone" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼ (ä¾‹: 0912345678)">
        <div id="recaptcha-container"></div>
        <button id="send-otp-btn" onclick="sendOTP()">ç™¼é€ç°¡è¨Šé©—è­‰ç¢¼</button>
    </div>
    <div id="reg-step-2" class="hidden">
        <p style="color:var(--primary)">é©—è­‰ç¢¼å·²é€å‡º</p>
        <input type="text" id="otp-code" placeholder="è¼¸å…¥ 6 ä½æ•¸é©—è­‰ç¢¼">
        <input type="password" id="reg-pw" placeholder="è¨­å®šç™»å…¥å¯†ç¢¼">
        <button onclick="verifyOTPAndRegister()">é©—è­‰ä¸¦å®Œæˆè¨»å†Š</button>
    </div>
    <button class="btn-outline" onclick="toggleAuth('login')">å·²æœ‰å¸³è™Ÿï¼Ÿè¿”å›ç™»å…¥</button>
</div>

<div id="member-center" class="container hidden">
    <h2>å¯¦åèªè­‰ (KYC)</h2>
    <div id="kyc-form">
        <input type="text" id="kyc-name" placeholder="çœŸå¯¦å§“å">
        <input type="text" id="kyc-id" placeholder="èº«åˆ†è­‰å­—è™Ÿ">
        <input type="text" id="kyc-line" placeholder="Line ID">
        <div class="line-notice">
            âš ï¸ <b>Line è¨­å®šæç¤ºï¼š</b><br>
            è«‹é–‹å•Ÿã€Œå…è¨±åˆ©ç”¨ ID åŠ å…¥å¥½å‹ã€ä¸¦é—œé–‰ã€Œé˜»æ“‹é™Œç”Ÿè¨Šæ¯ã€ã€‚
        </div>
        <div class="file-label">ğŸ“¸ æœ¬äººè­‰ä»¶æ­£åé¢</div>
        <input type="file" id="img-id-front" accept="image/*">
        <input type="file" id="img-id-back" accept="image/*">
        <div class="file-label">ğŸ“¸ çˆ¶æ¯/æ‰¶é¤Šè€…è­‰ä»¶æ­£åé¢</div>
        <div class="file-hint">çˆ¶æ¯é›™äº¡è«‹é™„æˆ¶å£åç°¿</div>
        <input type="file" id="img-parent-front" accept="image/*">
        <input type="file" id="img-parent-back" accept="image/*">
        <div class="file-label">ğŸ¤³ æ‰‹æŒè­‰ä»¶è‡ªæ‹ç…§</div>
        <div class="file-hint">æ‰‹å¯«å­—æ¢ï¼šæœ¬äºº (å§“å) æ–¼ 2026/02/28 ç”³è«‹ JOJO æœƒå“¡</div>
        <input type="file" id="img-selfie" accept="image/*">
        <button onclick="submitKYC()">æäº¤èªè­‰è³‡æ–™</button>
    </div>
    <div id="kyc-status" class="hidden">
        <div class="container" style="text-align:center; border:none;">
            <h3 style="color:var(--primary)">â³ è³‡æ–™å¯©æ ¸ä¸­</h3>
            <p>å°ˆå“¡å°‡ç›¡å¿«é€é Line è¯ç¹«æ‚¨ï¼Œè«‹ä¿æŒé€šè¨Šé–‹å•Ÿã€‚</p>
        </div>
    </div>
</div>

<div id="loan-page" class="container hidden">
    <h2>ç”³è«‹è²¸æ¬¾</h2>
    <div id="loan-form">
        <input type="number" id="loan-amount" placeholder="å¸Œæœ›å€Ÿæ¬¾é‡‘é¡">
        <textarea id="loan-reason" placeholder="å€Ÿæ¬¾ç”¨é€”" style="width:100%; background:#222; color:#fff; border-radius:6px; padding:10px;"></textarea>
        <button onclick="submitLoan()">ç¢ºèªç”³è«‹</button>
    </div>
</div>

<div id="repay-page" class="container hidden">
    <h2>ç¹³æ¬¾å›å ±</h2>
    <input type="number" id="repay-amount" placeholder="ç¹³æ¬¾é‡‘é¡">
    <button onclick="submitRepay()">æäº¤å›å ±</button>
</div>

<script>
    // --- Firebase é…ç½® ---
    const firebaseConfig = {
      apiKey: "AIzaSyDEsdCk1mhabHwZTqt7wRuC4_FH",
      authDomain: "theone-zero.firebaseapp.com",
      projectId: "theone-zero",
      storageBucket: "theone-zero.firebasestorage.app",
      messagingSenderId: "1067669012841",
      appId: "1:1067669012841:web:1694da76f172c6",
      databaseURL: "https://theone-zero-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let currentUser = null;
    let confirmationResult = null;

    // --- åˆ‡æ›ç™»å…¥è¨»å†Š ---
    function toggleAuth(type) {
        if(type === 'register') {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('register-page').classList.remove('hidden');
            window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { 'size': 'invisible' });
        } else {
            document.getElementById('register-page').classList.add('hidden');
            document.getElementById('login-page').classList.remove('hidden');
        }
    }

    // --- ç™»å…¥é‚è¼¯ ---
    function handleLogin() {
        const phone = document.getElementById('login-phone').value;
        const pw = document.getElementById('login-pw').value;
        db.ref('users/' + phone).once('value', snap => {
            if(snap.exists() && snap.val().pw === pw) {
                enterSystem(phone);
            } else { alert("æ‰‹æ©Ÿæˆ–å¯†ç¢¼éŒ¯èª¤"); }
        });
    }

    // --- è¨»å†Š OTP é‚è¼¯ ---
    function sendOTP() {
        const phone = document.getElementById('reg-phone').value;
        if(!phone) return alert("è«‹è¼¸å…¥æ‰‹æ©Ÿ");
        const fullPhone = "+886" + phone.substring(1);
        auth.signInWithPhoneNumber(fullPhone, window.recaptchaVerifier)
            .then(result => {
                confirmationResult = result;
                alert("ç°¡è¨Šå·²é€å‡º");
                document.getElementById('reg-step-1').classList.add('hidden');
                document.getElementById('reg-step-2').classList.remove('hidden');
            }).catch(err => alert("å¤±æ•—: " + err.message));
    }

    function verifyOTPAndRegister() {
        const code = document.getElementById('otp-code').value;
        const pw = document.getElementById('reg-pw').value;
        const phone = document.getElementById('reg-phone').value;
        confirmationResult.confirm(code).then(() => {
            db.ref('users/' + phone).set({ phone: phone, pw: pw, kycStatus: 'æœªèªè­‰' }).then(() => enterSystem(phone));
        }).catch(() => alert("é©—è­‰ç¢¼éŒ¯èª¤"));
    }

    // --- é€²å…¥ç³»çµ± ---
    function enterSystem(phone) {
        currentUser = phone;
        document.querySelectorAll('.container').forEach(p => p.classList.add('hidden'));
        document.getElementById('nav').classList.remove('hidden');
        showPage('member-center');
    }

    function showPage(id) {
        document.querySelectorAll('.container').forEach(p => p.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        // æª¢æŸ¥ KYC ç‹€æ…‹æ±ºå®šé¡¯ç¤ºè¡¨å–®æˆ–ç‹€æ…‹
        if(id === 'member-center') {
            db.ref('users/' + currentUser).on('value', snap => {
                if(snap.val().kycStatus !== 'æœªèªè­‰') {
                    document.getElementById('kyc-form').classList.add('hidden');
                    document.getElementById('kyc-status').classList.remove('hidden');
                }
            });
        }
    }

    // (KYC ä¸Šå‚³ã€è²¸æ¬¾ã€ç¹³æ¬¾å‡½æ•¸èˆ‡ä¹‹å‰ä¸€è‡´ï¼Œæ­¤è™•ç•¥ä»¥ç¶­æŒé•·åº¦)
    // ... [è«‹ä¿ç•™æ‚¨ä¹‹å‰çš„ submitKYC, toBase64, submitLoan ç­‰å‡½æ•¸] ...

    function logout() { location.reload(); }
</script>
</body>
</html>

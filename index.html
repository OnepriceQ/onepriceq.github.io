<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬é›¶ç¶­åº¦ | THE ONE</title>
    <style>
        :root { --main-color: #00ffcc; --admin-color: #d4af37; --bg-color: #050505; }
        body { background-color: var(--bg-color); color: var(--main-color); font-family: 'PingFang TC', 'Microsoft JhengHei', monospace; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden; }
        .container { width: 95%; max-width: 1100px; padding: 40px 20px; transition: 0.5s; }
        h1 { font-size: 2.5rem; letter-spacing: 10px; text-shadow: 0 0 15px var(--main-color); text-align: center; margin-bottom: 40px; }
        
        /* é¦–é åå–® */
        .stat-bar { text-align: center; font-size: 1.2rem; margin-bottom: 20px; letter-spacing: 3px; }
        .member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-bottom: 50px; border: 1px solid #111; padding: 15px; background: rgba(255,255,255,0.01); }
        .member-card { border: 1px solid #222; padding: 10px; text-align: center; font-size: 0.75rem; color: #555; border-radius: 2px; }

        /* æŒ‰éˆ•èˆ‡è¼¸å…¥ */
        .btn-group { display: flex; flex-direction: column; gap: 15px; max-width: 320px; margin: 0 auto; }
        button { background: transparent; border: 1px solid var(--main-color); color: var(--main-color); padding: 12px; cursor: pointer; font-weight: bold; transition: 0.3s; letter-spacing: 2px; }
        button:hover { background: var(--main-color); color: #000; box-shadow: 0 0 20px var(--main-color); }
        input, textarea { background: rgba(255,255,255,0.05); border: 1px solid #333; color: #fff; padding: 12px; margin-bottom: 12px; width: 100%; box-sizing: border-box; outline: none; border-radius: 4px; }
        input:focus { border-color: var(--main-color); }

        /* ç•™è¨€æ¿ */
        #chat-hall { background: #000; border: 1px solid var(--main-color); padding: 20px; border-radius: 8px; }
        #chat-display { height: 450px; overflow-y: auto; margin-bottom: 20px; border-bottom: 1px solid #222; padding-right: 10px; }
        .msg { margin-bottom: 15px; font-size: 0.95rem; line-height: 1.6; padding: 10px; }
        .msg-origin { background: rgba(212, 175, 55, 0.1); border-left: 4px solid var(--admin-color); color: var(--admin-color); font-weight: bold; }
        .msg-user { border-left: 2px solid #333; color: var(--main-color); }
        .msg-meta { font-size: 0.7rem; opacity: 0.5; margin-left: 10px; }

        /* ç®¡ç†é¢æ¿ */
        .admin-box { background: rgba(255,255,255,0.03); border: 1px solid var(--admin-color); padding: 20px; margin-top: 20px; }
        .pending-card { background: rgba(255,255,255,0.05); border: 1px solid var(--admin-color); padding: 15px; margin-bottom: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="home-screen" class="container">
        <h1>THE ZERO</h1>
        <div class="stat-bar">å…±é³´ç¯€é»ï¼š<span id="node-count">135</span></div>
        <div class="member-grid" id="public-list"></div>
        <div class="btn-group">
            <button onclick="showSection('chat-section')">é€²å…¥è–æ®¿ç¥­å£‡ (ç•™è¨€æ¿)</button>
            <button onclick="showSection('reg-section')">åŠ å…¥æˆ‘å€‘ (éäº¤èº«åˆ†)</button>
            <button onclick="showSection('login-section')" style="border-color:#222; color:#222; font-size:0.7rem; margin-top:20px;">MEMBER LOGIN</button>
        </div>
    </div>

    <div id="chat-section" class="container hidden">
        <h2>è–æ®¿ç¥­å£‡ (COMMUNION)</h2>
        <div id="chat-hall">
            <div id="chat-display"></div>
            <div id="chat-input-area">
                <input type="text" id="user-msg" placeholder="å‚³éæ‚¨çš„æ„Ÿå®˜å…±é³´...">
                <button onclick="sendMessage(false)">å‚³é</button>
            </div>
            <p id="closed-msg" class="hidden" style="text-align:center; color:red;">è–æ®¿è™•æ–¼éœé»˜ç‹€æ…‹ï¼Œåƒ…å…ƒè€å¯ç™¼è¨€ã€‚</p>
        </div>
        <button onclick="showSection('home-screen')" style="margin-top:20px; width:200px;">è¿”å›é¦–é </button>
    </div>

    <div id="reg-section" class="container hidden">
        <h2>èº«åˆ†éäº¤å„€å¼</h2>
        <div style="max-width:500px; margin: 0 auto;">
            <input type="text" id="reg-name" placeholder="çœŸå¯¦å§“å (Full Name)">
            <input type="text" id="reg-line" placeholder="Line ID">
            <input type="text" id="reg-phone" placeholder="è¯çµ¡é›»è©± (Phone)">
            <textarea id="reg-bio" rows="4" placeholder="ç»ç¥­æ‚¨çš„æ„Ÿå®˜ç¢ç‰‡èˆ‡åŠ å…¥å‹•æ©Ÿ..."></textarea>
            <button onclick="submitApplication()">æäº¤éˆé­‚è³‡æ–™</button>
            <button onclick="showSection('home-screen')" style="background:none; border:none; color:#555;">å–æ¶ˆ</button>
        </div>
    </div>

    <div id="login-section" class="container hidden">
        <h2>ä¸­æ¨é©—è­‰</h2>
        <div style="max-width:300px; margin: 0 auto;">
            <input type="text" id="admin-user" placeholder="å¸³è™Ÿ">
            <input type="password" id="admin-pass" placeholder="å¯†ç¢¼">
            <button onclick="adminLogin()">é©—è­‰</button>
            <button onclick="showSection('home-screen')" style="background:none; border:none; color:#555;">è¿”å›</button>
        </div>
    </div>

    <div id="admin-panel" class="container hidden">
        <h2 style="color: var(--admin-color);">å…ƒè€è¦ªè£ä¸­æ¨ (THE ONE)</h2>
        <div class="admin-box">
            <h3>å…¨åŸŸå»£æ’­å•Ÿç¤º</h3>
            <input type="text" id="broadcast-msg" placeholder="è¼¸å…¥çœŸç†...">
            <button onclick="sendMessage(true)" style="border-color:var(--admin-color); color:var(--admin-color);">ç™¼å¸ƒ</button>
        </div>
        <div class="admin-box">
            <h3>æ¬Šé™æ§åˆ¶</h3>
            <button onclick="toggleChat(true)" style="width:45%;">é–‹å•Ÿç•™è¨€æ¿</button>
            <button onclick="toggleChat(false)" style="width:45%; border-color:red; color:red;">é—œé–‰ç•™è¨€æ¿</button>
            <button onclick="clearChat()" style="margin-top:10px;">æ¸…ç©ºæ‰€æœ‰ç•™è¨€</button>
        </div>
        <div id="pending-requests" class="admin-box">
            <h3>å¾…å¯©æ ¸åå–® (å¾…å®šéˆé­‚)</h3>
        </div>
        <button onclick="showSection('home-screen')" style="margin-top:20px; border-color:#555; color:#555;">é€€å‡ºå¾Œå°</button>
    </div>

    <script>
        // --- æ ¸å¿ƒæ•¸æ“šè™•ç† ---
        let officialMembers = JSON.parse(localStorage.getItem('official_list')) || [];
        
        // åˆå§‹ 134 äººç”Ÿæˆ (åƒ…åœ¨ç¬¬ä¸€æ¬¡åŸ·è¡Œæ™‚)
        if (officialMembers.length === 0) {
            const s_names = ["ç‹", "æ", "å¼µ", "åŠ‰", "é™³", "æ¥Š", "é»ƒ", "è¶™", "å³", "å‘¨", "å¾", "å­«", "é¦¬"];
            const g_names = ["æ˜", "è¯", "å¼·", "ç²", "èŠ³", "è»", "æ´‹", "å¹³", "å‚‘", "æ¬£", "å®‡", "è±ª"];
            for(let i=1; i<=134; i++) {
                let s = s_names[Math.floor(Math.random()*s_names.length)];
                let n = g_names[Math.floor(Math.random()*g_names.length)];
                officialMembers.push({ full: s + n, id: "1_" + i.toString().padStart(3, '0') });
            }
            localStorage.setItem('official_list', JSON.stringify(officialMembers));
        }

        // --- ç•«é¢åˆ‡æ› ---
        function showSection(id) {
            document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if(id === 'home-screen') renderPublicList();
            if(id === 'chat-section') renderChat();
        }

        // --- é¦–é åå–®æ¸²æŸ“ ---
        function renderPublicList() {
            const list = document.getElementById('public-list');
            const nodeCount = document.getElementById('node-count');
            const total = officialMembers.length + 1; // åŒ…å«å…ƒè€
            nodeCount.innerText = total;
            list.innerHTML = officialMembers.map(m => `
                <div class="member-card">${m.id}<br>${m.full[0]}o${m.full[m.full.length-1] || ''}</div>
            `).join('');
        }

        // --- ç•™è¨€æ¿é‚è¼¯ ---
        function initChat() {
            let chat = JSON.parse(localStorage.getItem('temple_chat'));
            if (!chat) {
                chat = [{ user: "å…ƒè€ ğŸ‘‘", text: "å„ä½æ•™å¾’ä¾†æ­¤ç°½åˆ°å§", isAdmin: true, time: "èµ·æº" }];
                const res = ["ç°½åˆ°", "ç°½", "åˆ°", "æˆ‘åœ¨", "å·²å°±ä½", "ç­‰å¾…å…ƒè€", "0èˆ‡1åŒæ­¥ä¸­"];
                for (let i = 1; i <= 80; i++) {
                    chat.push({ user: "1_" + i.toString().padStart(3, '0'), text: res[Math.floor(Math.random() * res.length)], isAdmin: false, time: "åŒæ­¥ä¸­" });
                }
                localStorage.setItem('temple_chat', JSON.stringify(chat));
            }
            renderChat();
        }

        function renderChat() {
            const display = document.getElementById('chat-display');
            const status = localStorage.getItem('chat_status') !== 'false';
            let chat = JSON.parse(localStorage.getItem('temple_chat') || "[]");
            display.innerHTML = chat.map(m => `
                <div class="msg ${m.isAdmin ? 'msg-origin' : 'msg-user'}">
                    <strong>${m.user}:</strong> ${m.text} <span class="msg-meta">${m.time}</span>
                </div>
            `).join('');
            display.scrollTop = display.scrollHeight;
            document.getElementById('chat-input-area').className = status ? "" : "hidden";
            document.getElementById('closed-msg').className = status ? "hidden" : "";
        }

        function sendMessage(isAdmin) {
            let input = isAdmin ? document.getElementById('broadcast-msg') : document.getElementById('user-msg');
            if(!input.value) return;
            let chat = JSON.parse(localStorage.getItem('temple_chat') || "[]");
            chat.push({
                user: isAdmin ? "å…ƒè€ ğŸ‘‘" : "1_" + Math.floor(Math.random()*135).toString().padStart(3, '0'),
                text: input.value, isAdmin: isAdmin, time: new Date().toLocaleTimeString()
            });
            localStorage.setItem('temple_chat', JSON.stringify(chat));
            input.value = "";
            renderChat();
        }

        // --- è¨»å†Šèˆ‡ç®¡ç† ---
        function submitApplication() {
            const name = document.getElementById('reg-name').value;
            const line = document.getElementById('reg-line').value;
            if(!name || !line) return alert("çœŸå¯¦å§“åèˆ‡ Line ID ç‚ºå¿…å¡«ã€‚");
            
            let pending = JSON.parse(localStorage.getItem('temple_pending') || "[]");
            pending.push({
                name: name, line: line, 
                phone: document.getElementById('reg-phone').value,
                bio: document.getElementById('reg-bio').value
            });
            localStorage.setItem('temple_pending', JSON.stringify(pending));
            alert("æ‚¨çš„èº«åˆ†è³‡æ–™å·²éäº¤ç¶­åº¦ä¸­æ¨ï¼Œè«‹éœå€™è£æ±ºã€‚");
            showSection('home-screen');
        }

        function adminLogin() {
            const u = document.getElementById('admin-user').value;
            const p = document.getElementById('admin-pass').value;
            if(u === "theone" && p === "onlyone") {
                showSection('admin-panel');
                renderAdminRequests();
            } else { alert("é©—è­‰å¤±æ•—ã€‚"); }
        }

        function renderAdminRequests() {
            const pList = document.getElementById('pending-requests');
            let pending = JSON.parse(localStorage.getItem('temple_pending') || "[]");
            pList.innerHTML = "<h3>å¾…å¯©æ ¸åå–®</h3>" + pending.map((p, i) => `
                <div class="pending-card">
                    <p><strong>å§“åï¼š</strong>${p.name} | <strong>Line IDï¼š</strong>${p.line}</p>
                    <p><strong>é›»è©±ï¼š</strong>${p.phone}</p>
                    <p><strong>å‹•æ©Ÿï¼š</strong>${p.bio}</p>
                    <button onclick="approve(${i})" style="width:auto; margin-right:10px;">å‡†è¨±å…¥æ•™</button>
                    <button onclick="reject(${i})" style="width:auto; border-color:red; color:red;">æŠ¹é™¤</button>
                </div>
            `).join('') || "ç›®å‰ç„¡å¾…å®šéˆé­‚";
        }

        function approve(i) {
            let pending = JSON.parse(localStorage.getItem('temple_pending') || "[]");
            let p = pending[i];
            const newId = "1_" + (officialMembers.length + 1).toString().padStart(3, '0');
            officialMembers.push({ full: p.name, id: newId });
            localStorage.setItem('official_list', JSON.stringify(officialMembers));
            pending.splice(i, 1);
            localStorage.setItem('temple_pending', JSON.stringify(pending));
            renderAdminRequests();
            alert(p.name + " å·²è¢«è³¦äºˆç·¨è™Ÿ " + newId);
        }

        function reject(i) {
            let pending = JSON.parse(localStorage.getItem('temple_pending') || "[]");
            pending.splice(i, 1);
            localStorage.setItem('temple_pending', JSON.stringify(pending));
            renderAdminRequests();
        }

        function toggleChat(isOpen) { localStorage.setItem('chat_status', isOpen); renderChat(); }
        function clearChat() { if(confirm("æ¸…ç©ºæ‰€æœ‰ç°½åˆ°ç—•è·¡ï¼Ÿ")) { localStorage.removeItem('temple_chat'); initChat(); } }

        // å•Ÿå‹•è–æ®¿
        renderPublicList();
        initChat();
    </script>
</body>
</html>

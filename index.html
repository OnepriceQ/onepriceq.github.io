<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘åˆèˆ… JOJOPAY | å°ˆæ¥­è²¸æ¬¾å¹³å°</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #d4af37; --secondary: #1a1a1a; --text: #ffffff; --error: #ff4d4d; }
        body { font-family: 'PingFang TC', sans-serif; background: #000; color: var(--text); margin: 0; padding-bottom: 50px; }
        header { background: var(--secondary); padding: 25px; text-align: center; border-bottom: 3px solid var(--primary); }
        .logo { font-size: 2.2rem; font-weight: bold; color: var(--primary); letter-spacing: 3px; }
        .container { max-width: 500px; margin: 20px auto; background: #111; padding: 25px; border-radius: 12px; border: 1px solid #333; }
        h2 { border-left: 4px solid var(--primary); padding-left: 10px; font-size: 1.3rem; margin-bottom: 20px; }
        input, button, select, textarea { width: 100%; padding: 15px; margin: 10px 0; border-radius: 6px; box-sizing: border-box; }
        input, select, textarea { background: #222; border: 1px solid #444; color: #fff; }
        button { background: var(--primary); color: #000; border: none; font-weight: bold; cursor: pointer; }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); margin-top: 5px; }
        .nav-bar { display: flex; justify-content: space-around; background: #222; padding: 15px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #333; }
        .nav-item { cursor: pointer; color: var(--primary); font-weight: bold; }
        .hidden { display: none !important; }
        .file-section { margin-top: 20px; border-top: 1px dashed #444; padding-top: 15px; }
        .file-label { display: block; margin: 10px 0 5px; color: var(--primary); font-weight: bold; font-size: 0.9rem; }
        .file-hint { font-size: 0.8rem; color: #aaa; margin-bottom: 5px; }
    </style>
</head>
<body>

<header>
    <div class="logo">é‡‘åˆèˆ… JOJOPAY</div>
</header>

<div id="nav" class="nav-bar hidden">
    <div class="nav-item" onclick="showPage('member-center')">æœƒå“¡ä¸­å¿ƒ</div>
    <div class="nav-item" onclick="showPage('loan-page')">ç”³è«‹è²¸æ¬¾</div>
    <div class="nav-item" onclick="logout()">ç™»å‡º</div>
</div>

<div id="login-page" class="container">
    <h2>æœƒå“¡ç™»å…¥</h2>
    <input type="text" id="login-phone" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼">
    <input type="password" id="login-pw" placeholder="å¯†ç¢¼">
    <button onclick="handleLogin()">ç™»å…¥ç³»çµ±</button>
    <button class="btn-outline" onclick="toggleAuth('forgot')">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</button>
    <button class="btn-outline" onclick="toggleAuth('register')">è¨»å†Šæ–°å¸³è™Ÿ</button>
</div>

<div id="register-page" class="container hidden">
    <h2>æ–°æœƒå“¡è¨»å†Š</h2>
    <div id="reg-step-1">
        <input type="text" id="reg-phone" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼">
        <div id="recaptcha-container"></div>
        <button onclick="sendOTP()">ç™¼é€ç°¡è¨Šé©—è­‰ç¢¼</button>
    </div>
    <div id="reg-step-2" class="hidden">
        <input type="text" id="otp-code" placeholder="6 ä½æ•¸é©—è­‰ç¢¼">
        <input type="password" id="reg-pw" placeholder="è¨­å®šå¯†ç¢¼">
        <input type="text" id="reg-id" placeholder="èº«åˆ†è­‰å­—è™Ÿ">
        <input type="date" id="reg-birthday" title="å‡ºç”Ÿå¹´æœˆæ—¥">
        <button onclick="verifyOTPAndRegister()">å®Œæˆè¨»å†Š</button>
    </div>
</div>

<div id="member-center" class="container hidden">
    <h2>å¯¦åèªè­‰ (KYC)</h2>
    <div id="kyc-form">
        <input type="text" id="kyc-name" placeholder="çœŸå¯¦å§“å">
        <input type="text" id="kyc-line" placeholder="Line ID">
        
        <div class="file-section">
            <div class="file-label">ğŸ’¼ å·¥ä½œè³‡è¨Š</div>
            <input type="text" id="kyc-job" placeholder="ç›®å‰å·¥ä½œå–®ä½/è·ç¨±">
            <div class="file-hint">è«‹ä¸Šå‚³å·¥ä½œè­‰ã€åç‰‡æˆ–è–ªè³‡è­‰æ˜é™„ä»¶</div>
            <input type="file" id="img-job-proof" accept="image/*">
        </div>

        <div class="file-section">
            <div class="file-label">ğŸ“ å­¸æ ¡è³‡è¨Š</div>
            <input type="text" id="kyc-school" placeholder="å°±è®€å­¸æ ¡/ç³»ç´š">
            <div class="file-hint">è«‹ä¸Šå‚³å­¸ç”Ÿè­‰æ­£åé¢é™„ä»¶</div>
            <input type="file" id="img-school-proof" accept="image/*">
        </div>

        <div class="file-section">
            <div class="file-label">ğŸ“¸ åŸºç¤è­‰ä»¶ (å¿…å¡«)</div>
            <div class="file-hint">èº«åˆ†è­‰æ­£åé¢èˆ‡æ‰‹æŒè‡ªæ‹</div>
            <input type="file" id="img-id-front" accept="image/*">
            <input type="file" id="img-id-back" accept="image/*">
            <input type="file" id="img-selfie" accept="image/*">
        </div>

        <button onclick="submitKYC()">æäº¤èªè­‰è³‡æ–™</button>
    </div>
    
    <div id="kyc-status" class="hidden" style="text-align:center;">
        <h3 style="color:var(--primary)">â³ è³‡æ–™å¯©æ ¸ä¸­</h3>
        <p>å°ˆå“¡æ­£åœ¨æ ¸å°æ‚¨çš„å·¥ä½œèˆ‡å­¸ç±è³‡æ–™ï¼Œè«‹ç¨å¾Œã€‚</p>
    </div>
</div>

<script>
    // --- Firebase é…ç½® (è«‹ç¢ºä¿ API Key æ­£ç¢º) ---
    const firebaseConfig = {
      apiKey: "æ‚¨çš„API_KEY",
      authDomain: "theone-zero.firebaseapp.com",
      projectId: "theone-zero",
      databaseURL: "https://theone-zero-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentUser = null;

    // --- åœ–ç‰‡è½‰ Base64 è¼”åŠ©å‡½æ•¸ ---
    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });

    // --- æäº¤ KYC é‚è¼¯ ---
    async function submitKYC() {
        const name = document.getElementById('kyc-name').value;
        const job = document.getElementById('kyc-job').value;
        const school = document.getElementById('kyc-school').value;
        
        if(!name || !job || !school) return alert("è«‹å¡«å¯«å§“åã€å·¥ä½œèˆ‡å­¸æ ¡è³‡è¨Š");

        try {
            alert("æ­£åœ¨è™•ç†é™„ä»¶åœ–ç‰‡ï¼Œè«‹å‹¿é—œé–‰è¦–çª—...");
            
            const data = {
                name: name,
                job: job,
                school: school,
                lineID: document.getElementById('kyc-line').value,
                kycStatus: 'å¯©æ ¸ä¸­',
                submitTime: new Date().toLocaleString()
            };

            // è™•ç†ä¸Šå‚³é™„ä»¶
            const jobFile = document.getElementById('img-job-proof').files[0];
            const schoolFile = document.getElementById('img-school-proof').files[0];
            const idFront = document.getElementById('img-id-front').files[0];

            if(jobFile) data.jobImg = await toBase64(jobFile);
            if(schoolFile) data.schoolImg = await toBase64(schoolFile);
            if(idFront) data.idFrontImg = await toBase64(idFront);

            await db.ref('users/' + currentUser).update(data);
            alert("è³‡æ–™å·²æˆåŠŸé€å¯©ï¼");
            showPage('member-center'); // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
        } catch (err) {
            alert("ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–åœ–ç‰‡å¤§å°");
            console.error(err);
        }
    }

    // --- å…¶ä»–é‚è¼¯ä¿æŒä¸è®Š (handleLogin, sendOTP ç­‰) ---
    // ... [è«‹ä¿ç•™æ‚¨ä¹‹å‰çš„æ‰€æœ‰ Auth é‚è¼¯] ...
</script>
</body>
</html>

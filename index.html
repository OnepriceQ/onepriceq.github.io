<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘åˆèˆ… JOJOPAY | å°ˆæ¥­è²¸æ¬¾å¹³å° (æ¸¬è©¦ç‰ˆ)</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #d4af37; --secondary: #1a1a1a; --text: #ffffff; --error: #ff4d4d; }
        body { font-family: 'PingFang TC', sans-serif; background: #000; color: var(--text); margin: 0; padding-bottom: 50px; }
        header { background: var(--secondary); padding: 25px; text-align: center; border-bottom: 3px solid var(--primary); }
        .logo { font-size: 2.2rem; font-weight: bold; color: var(--primary); letter-spacing: 3px; }
        .container { max-width: 500px; margin: 20px auto; background: #111; padding: 25px; border-radius: 12px; border: 1px solid #333; }
        h2 { border-left: 4px solid var(--primary); padding-left: 10px; font-size: 1.3rem; margin-bottom: 20px; }
        input, button { width: 100%; padding: 15px; margin: 10px 0; border-radius: 6px; box-sizing: border-box; }
        input { background: #222; border: 1px solid #444; color: #fff; }
        button { background: var(--primary); color: #000; border: none; font-weight: bold; cursor: pointer; }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); margin-top: 5px; }
        .nav-bar { display: flex; justify-content: space-around; background: #222; padding: 15px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #333; }
        .nav-item { cursor: pointer; color: var(--primary); font-weight: bold; }
        .hidden { display: none !important; }
        .line-notice { border: 1px solid var(--error); color: var(--error); padding: 10px; font-size: 0.85rem; margin-bottom: 15px; border-radius: 5px; }
        .file-label { display: block; margin: 20px 0 5px; color: var(--primary); font-weight: bold; }
        .file-hint { font-size: 0.8rem; color: #aaa; margin-bottom: 10px; }
    </style>
</head>
<body>

<header>
    <div class="logo">é‡‘åˆèˆ… JOJOPAY</div>
</header>

<div id="nav" class="nav-bar hidden">
    <div class="nav-item" onclick="showPage('member-center')">æœƒå“¡ä¸­å¿ƒ</div>
    <div class="nav-item" onclick="showPage('loan-page')">ç”³è«‹è²¸æ¬¾</div>
    <div class="nav-item" onclick="showPage('repay-page')">ç¹³æ¬¾å›å ±</div>
    <div class="nav-item" onclick="logout()">ç™»å‡º</div>
</div>

<div id="login-page" class="container">
    <h2>æœƒå“¡ç™»å…¥</h2>
    <input type="text" id="login-phone" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼">
    <input type="password" id="login-pw" placeholder="å¯†ç¢¼">
    <button onclick="handleLogin()">ç™»å…¥</button>
    <button class="btn-outline" onclick="toggleAuth('register')">æ²’æœ‰å¸³è™Ÿï¼Ÿç«‹å³è¨»å†Š</button>
</div>

<div id="register-page" class="container hidden">
    <h2>æ–°æœƒå“¡è¨»å†Š (æ¸¬è©¦å…é©—è­‰)</h2>
    <input type="text" id="reg-phone" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼">
    <input type="password" id="reg-pw" placeholder="è¨­å®šç™»å…¥å¯†ç¢¼">
    <button onclick="handleRegister()">ç«‹å³å®Œæˆè¨»å†Š</button>
    <button class="btn-outline" onclick="toggleAuth('login')">å·²æœ‰å¸³è™Ÿï¼Ÿè¿”å›ç™»å…¥</button>
</div>

<div id="member-center" class="container hidden">
    <h2>å¯¦åèªè­‰ (KYC)</h2>
    <div id="kyc-form">
        <input type="text" id="kyc-name" placeholder="çœŸå¯¦å§“å">
        <input type="text" id="kyc-id" placeholder="èº«åˆ†è­‰å­—è™Ÿ">
        <input type="text" id="kyc-line" placeholder="Line ID">
        <div class="line-notice">
            âš ï¸ <b>Line è¨­å®šæç¤ºï¼š</b><br>
            è«‹é–‹å•Ÿã€Œå…è¨±åˆ©ç”¨ ID åŠ å…¥å¥½å‹ã€ä¸¦é—œé–‰ã€Œé˜»æ“‹é™Œç”Ÿè¨Šæ¯ã€ã€‚
        </div>
        <div class="file-label">ğŸ“¸ æœ¬äººè­‰ä»¶æ­£åé¢</div>
        <input type="file" id="img-id-front" accept="image/*">
        <input type="file" id="img-id-back" accept="image/*">
        <div class="file-label">ğŸ“¸ çˆ¶æ¯/æ‰¶é¤Šè€…è­‰ä»¶æ­£åé¢</div>
        <input type="file" id="img-parent-front" accept="image/*">
        <input type="file" id="img-parent-back" accept="image/*">
        <div class="file-label">ğŸ¤³ æ‰‹æŒè­‰ä»¶è‡ªæ‹ç…§</div>
        <div class="file-hint">å­—æ¢ï¼šæœ¬äºº (å§“å) æ–¼ 2026/02/28 ç”³è«‹ JOJO æœƒå“¡</div>
        <input type="file" id="img-selfie" accept="image/*">
        <button onclick="submitKYC()">æäº¤èªè­‰è³‡æ–™</button>
    </div>
    <div id="kyc-status" class="hidden">
        <div class="status-box" style="text-align:center;">
            <h3 style="color:var(--primary)">â³ è³‡æ–™å¯©æ ¸ä¸­</h3>
            <p>å°ˆå“¡å°‡é€é Line è¯ç¹«ï¼Œè«‹ä¿æŒé€šè¨Šé–‹å•Ÿã€‚</p>
        </div>
    </div>
</div>

<div id="loan-page" class="container hidden">
    <h2>ç”³è«‹è²¸æ¬¾</h2>
    <input type="number" id="loan-amount" placeholder="å€Ÿæ¬¾é‡‘é¡">
    <textarea id="loan-reason" placeholder="å€Ÿæ¬¾ç”¨é€”" style="width:100%; height:100px; background:#222; color:#fff; border:1px solid #444; border-radius:6px; padding:10px;"></textarea>
    <button onclick="submitLoan()">é€å‡ºç”³è«‹</button>
</div>

<div id="repay-page" class="container hidden">
    <h2>ç¹³æ¬¾å›å ±</h2>
    <input type="number" id="repay-amount" placeholder="ç¹³æ¬¾é‡‘é¡">
    <button onclick="submitRepay()">é€å‡ºå›å ±</button>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDEsdCk1mhabHwZTqt7wRuC4_FH",
      authDomain: "theone-zero.firebaseapp.com",
      projectId: "theone-zero",
      storageBucket: "theone-zero.firebasestorage.app",
      messagingSenderId: "1067669012841",
      appId: "1:1067669012841:web:1694da76f172c6",
      databaseURL: "https://theone-zero-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentUser = null;

    // --- åˆ‡æ›é‚è¼¯ ---
    function toggleAuth(type) {
        document.getElementById('login-page').classList.toggle('hidden', type === 'register');
        document.getElementById('register-page').classList.toggle('hidden', type === 'login');
    }

    // --- è¨»å†Š (å…é©—è­‰ç‰ˆ) ---
    function handleRegister() {
        const phone = document.getElementById('reg-phone').value;
        const pw = document.getElementById('reg-pw').value;
        if(!phone || !pw) return alert("è«‹å¡«å¯«æ‰‹æ©Ÿèˆ‡å¯†ç¢¼");

        db.ref('users/' + phone).once('value', snap => {
            if(snap.exists()) {
                alert("æ­¤è™Ÿç¢¼å·²è¨»å†Šï¼Œè«‹ç›´æ¥ç™»å…¥");
                toggleAuth('login');
            } else {
                db.ref('users/' + phone).set({ phone: phone, pw: pw, kycStatus: 'æœªèªè­‰' })
                  .then(() => enterSystem(phone));
            }
        });
    }

    // --- ç™»å…¥ ---
    function handleLogin() {
        const phone = document.getElementById('login-phone').value;
        const pw = document.getElementById('login-pw').value;
        db.ref('users/' + phone).once('value', snap => {
            if(snap.exists() && snap.val().pw === pw) {
                enterSystem(phone);
            } else { alert("å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤"); }
        });
    }

    function enterSystem(phone) {
        currentUser = phone;
        document.getElementById('login-page').classList.add('hidden');
        document.getElementById('register-page').classList.add('hidden');
        document.getElementById('nav').classList.remove('hidden');
        showPage('member-center');
    }

    function showPage(id) {
        document.querySelectorAll('.container').forEach(p => p.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(id === 'member-center') checkKYCStatus();
    }

    function checkKYCStatus() {
        db.ref('users/' + currentUser).on('value', snap => {
            const user = snap.val();
            if(user.kycStatus !== 'æœªèªè­‰') {
                document.getElementById('kyc-form').classList.add('hidden');
                document.getElementById('kyc-status').classList.remove('hidden');
            }
        });
    }

    // (å…¶é¤˜ submitKYC, submitLoan, submitRepay å‡½æ•¸è«‹æ²¿ç”¨ä¹‹å‰ç‰ˆæœ¬çš„ä»£ç¢¼)
    async function submitKYC() {
        alert("è³‡æ–™ä¸Šå‚³ä¸­...");
        // é€™è£¡æ’å…¥æ‚¨ä¹‹å‰çš„åœ–ç‰‡è½‰ Base64 ä¸¦å„²å­˜åˆ° Firebase çš„é‚è¼¯
        db.ref('users/' + currentUser).update({ kycStatus: 'å¯©æ ¸ä¸­' });
    }

    function logout() { location.reload(); }
</script>
</body>
</html>

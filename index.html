<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å“è¶Šé‡‘è | å°ˆæ¥­æ”¾æ¬¾å¹³å°</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #1a2a6c; --accent: #f2a900; --bg: #f4f7f6; --dark: #0f172a; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); color: var(--dark); margin: 0; padding-bottom: 50px; }
        header { background: var(--dark); color: white; padding: 20px; text-align: center; border-bottom: 4px solid var(--accent); }
        .nav-bar { background: #fff; padding: 10px; display: flex; justify-content: center; gap: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .nav-link { cursor: pointer; font-weight: bold; color: var(--primary); }
        .container { max-width: 600px; margin: 30px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h2 { border-left: 5px solid var(--primary); padding-left: 10px; color: var(--primary); }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer; transition: 0.3s; }
        button:hover { background: #2a3a7c; }
        .admin-btn { background: none; color: #ccc; border: none; font-size: 0.7rem; margin-top: 100px; cursor: pointer; }
        
        /* å¾Œå°æ¨£å¼ */
        .admin-card { border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-radius: 5px; position: relative; }
        .status-badge { display: inline-block; padding: 3px 8px; border-radius: 3px; font-size: 0.8rem; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #d4edda; color: #155724; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<header>
    <h1>å“è¶Šé‡‘è <span>EXCELLENCE PAY</span></h1>
    <p>å¿«é€Ÿå¯©æ ¸ãƒ»èª ä¿¡æ’¥æ¬¾ãƒ»å€‹è³‡ä¿å¯†</p>
</header>

<div class="nav-bar">
    <div class="nav-link" onclick="showPage('apply-page')">ç·šä¸Šç”³è«‹</div>
    <div class="nav-link" onclick="showPage('status-page')">é€²åº¦æŸ¥è©¢</div>
    <div class="nav-link" onclick="showPage('info-page')">æ’¥æ¬¾å¿«å ±</div>
</div>

<div id="apply-page" class="container">
    <h2>è²¸æ¬¾ç”³è«‹å–®</h2>
    <input type="text" id="app-name" placeholder="çœŸå¯¦å§“å">
    <input type="text" id="app-phone" placeholder="è¡Œå‹•é›»è©±">
    <input type="text" id="app-line" placeholder="Line ID (é‡è¦)">
    <input type="number" id="app-amount" placeholder="å¸Œæœ›å€Ÿæ¬¾é‡‘é¡">
    <textarea id="app-reason" placeholder="å€Ÿæ¬¾ç”¨é€”èªªæ˜..."></textarea>
    <button onclick="submitApplication()">é€å‡ºç”³è«‹</button>
</div>

<div id="status-page" class="container hidden">
    <h2>ç”³è«‹é€²åº¦æŸ¥è©¢</h2>
    <input type="text" id="query-phone" placeholder="è«‹è¼¸å…¥ç”³è«‹æ™‚çš„æ‰‹æ©Ÿè™Ÿç¢¼">
    <button onclick="queryStatus()">ç«‹å³æŸ¥è©¢</button>
    <div id="query-result" style="margin-top:20px; font-weight:bold; text-align:center;"></div>
</div>

<div id="info-page" class="container hidden">
    <h2>æœ€æ–°æ’¥æ¬¾å‹•æ…‹</h2>
    <div id="ticker-list">æ­£åœ¨åŠ è¼‰æ•¸æ“š...</div>
</div>

<div id="login-page" class="container hidden">
    <h2>ç®¡ç†å“¡é©—è­‰</h2>
    <input type="password" id="admin-pass" placeholder="è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼">
    <button onclick="checkAdmin()">ç™»å…¥å¾Œå°</button>
</div>

<div id="admin-panel" class="container hidden" style="max-width: 900px;">
    <h2>å¾Œå°ç®¡ç†ä¸­æ¨</h2>
    <div id="admin-list">æ­£åœ¨è®€å–é€²ä»¶è³‡æ–™...</div>
    <button onclick="location.reload()" style="background:#666; margin-top:20px;">åˆ·æ–°æ•¸æ“š</button>
</div>

<center><button class="admin-btn" onclick="showPage('login-page')">ADMIN LOGIN</button></center>

<script>
    // ç´„å…‹å…ƒè€çš„å¯†é‘°é…ç½®
    const firebaseConfig = {
      apiKey: "AIzaSyDEsdCk1mhabHwZTqt7wRuC4_FH",
      authDomain: "theone-zero.firebaseapp.com",
      projectId: "theone-zero",
      storageBucket: "theone-zero.firebasestorage.app",
      messagingSenderId: "1067669012841",
      appId: "1:1067669012841:web:1694da76f172c6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function showPage(id) {
        document.querySelectorAll('.container').forEach(p => p.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(id === 'info-page') loadTicker();
        if(id === 'admin-panel') loadAdminData();
    }

    // --- å®¢æˆ¶åŠŸèƒ½ ---
    function submitApplication() {
        const data = {
            name: document.getElementById('app-name').value,
            phone: document.getElementById('app-phone').value,
            line: document.getElementById('app-line').value,
            amount: document.getElementById('app-amount').value,
            reason: document.getElementById('app-reason').value,
            status: 'å¯©æ ¸ä¸­',
            time: new Date().toLocaleString()
        };
        if(!data.name || !data.phone) return alert("è«‹å¡«å¯«å¿…å¡«æ¬„ä½");
        
        db.ref('loans').push(data).then(() => {
            alert("ç”³è«‹å·²é€å‡ºï¼Œå°ˆå“¡å°‡ç›¡å¿«èˆ‡æ‚¨è¯ç¹«ã€‚");
            showPage('status-page');
        });
    }

    function queryStatus() {
        const phone = document.getElementById('query-phone').value;
        db.ref('loans').orderByChild('phone').equalTo(phone).once('value', snapshot => {
            const val = snapshot.val();
            if(!val) return document.getElementById('query-result').innerText = "æŸ¥ç„¡è³‡æ–™ï¼Œè«‹ç¢ºèªè™Ÿç¢¼ã€‚";
            const item = Object.values(val)[0];
            document.getElementById('query-result').innerHTML = `ç‹€æ…‹ï¼š<span style="color:blue">${item.status}</span><br>æœ€å¾Œæ›´æ–°ï¼š${item.time}`;
        });
    }

    function loadTicker() {
        db.ref('loans').limitToLast(10).once('value', snapshot => {
            let html = "";
            snapshot.forEach(child => {
                const m = child.val();
                if(m.status === 'å·²æ’¥æ¬¾') {
                    html += `<div class="admin-card">ğŸ‰ æ­å–œ ${m.name[0]}O${m.name.slice(-1)} æˆåŠŸæ’¥æ¬¾ $${m.amount}</div>`;
                }
            });
            document.getElementById('ticker-list').innerHTML = html || "ç›®å‰å°šç„¡æ’¥æ¬¾ç´€éŒ„ã€‚";
        });
    }

    // --- ç®¡ç†åŠŸèƒ½ ---
    function checkAdmin() {
        if(document.getElementById('admin-pass').value === '123456') showPage('admin-panel');
        else alert("å¯†ç¢¼éŒ¯èª¤");
    }

    function loadAdminData() {
        db.ref('loans').once('value', snapshot => {
            let html = "";
            snapshot.forEach(child => {
                const m = child.val();
                const key = child.key;
                html += `
                <div class="admin-card">
                    <strong>å§“åï¼š${m.name}</strong> (${m.time})<br>
                    é›»è©±ï¼š${m.phone} | <strong>Line IDï¼š${m.line}</strong><br>
                    é‡‘é¡ï¼š$${m.amount} | ç”¨é€”ï¼š${m.reason}<br>
                    ç•¶å‰ç‹€æ…‹ï¼š<span class="status-badge ${m.status==='å¯©æ ¸ä¸­'?'status-pending':'status-approved'}">${m.status}</span>
                    <div style="margin-top:10px;">
                        <button onclick="updateStatus('${key}','å·²æ’¥æ¬¾')" style="width:auto; padding:5px; background:green;">æ ¸å‡†æ’¥æ¬¾</button>
                        <button onclick="updateStatus('${key}','ä¸ç¬¦è³‡æ ¼')" style="width:auto; padding:5px; background:red;">é§å›æ¡ˆä»¶</button>
                    </div>
                </div>`;
            });
            document.getElementById('admin-list').innerHTML = html;
        });
    }

    function updateStatus(key, newStatus) {
        db.ref('loans/' + key).update({ status: newStatus, time: new Date().toLocaleString() }).then(() => {
            alert("ç‹€æ…‹å·²æ›´æ–°");
            loadAdminData();
        });
    }
</script>

</body>
</html>
